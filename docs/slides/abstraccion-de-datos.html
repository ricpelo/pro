<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Ricardo Pérez López">
  <title>Abstracción de datos</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="./reveal.js/dist/reset.css">
  <link rel="stylesheet" href="./reveal.js/dist/reveal.css">
  <style>
    .reveal .sourceCode {  /* see #7635 */
      overflow: visible;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #268bd2;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #cb4b16; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #d33682; } /* BaseN */
    code span.bu { color: #4070a0; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #dc322f; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #93a1a1; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #6c71c4; } /* DataType */
    code span.dv { color: #d33682; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #d33682; } /* Float */
    code span.fu { color: #4070a0; } /* Function */
    code span.im { font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #268bd2; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #a57800; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #2aa198; } /* SpecialString */
    code span.st { color: #2aa198; } /* String */
    code span.va { color: #6c71c4; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
      margin-bottom: 0em;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="./reveal.js/dist/theme/solarized.css" id="theme">
  <link rel="stylesheet" href="custom.css"/>
  <script defer=""
  src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <link rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css" />
  <link href="https://fonts.googleapis.com/css?family=Lato&display=swap" rel="stylesheet">
  <style type="text/css">
      #header-left {
          position: absolute;
          font-size: 25%;
          top: 0%;
          left: 0%;
          margin-left: 10px;
          margin-top: 10px;
      }
      #header-right {
          position: absolute;
          font-size: 25%;
          top: 0%;
          right: 0%;
          margin-right: 10px;
          margin-top: 10px;
      }
      #footer-left {
          position: absolute;
          font-size: 25%;
          bottom: 0%;
          left: 0%;
          margin-left: 10px;
          margin-bottom: 10px;
      }
  </style>
</head>
<body>
<div id="hidden" style="display:none;">
    <div id="header">
        <div id="header-left"></div>
        <div id="header-right"></div>
        <div id="footer-left"></div>
    </div>
</div>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Abstracción de datos</h1>
  <p class="author">Ricardo Pérez López</p>
  <p class="date">IES Doñana, curso 2025/2026</p>
</section>
<section id="TOC">
<nav role="doc-toc"> 
<ul>
<li><a href="#/introducción" id="/toc-introducción"><span
class="toc-section-number">1</span> Introducción</a></li>
<li><a href="#/especificaciones" id="/toc-especificaciones"><span
class="toc-section-number">2</span> Especificaciones</a></li>
<li><a href="#/implementaciones" id="/toc-implementaciones"><span
class="toc-section-number">3</span> Implementaciones</a></li>
<li><a href="#/niveles-y-barreras-de-abstracción"
id="/toc-niveles-y-barreras-de-abstracción"><span
class="toc-section-number">4</span> Niveles y barreras de
abstracción</a></li>
<li><a href="#/las-funciones-como-datos"
id="/toc-las-funciones-como-datos"><span
class="toc-section-number">5</span> Las funciones como datos</a></li>
<li><a href="#/abstracción-de-datos-y-modularidad"
id="/toc-abstracción-de-datos-y-modularidad"><span
class="toc-section-number">6</span> Abstracción de datos y
modularidad</a></li>
</ul>
</nav>
</section>

<section>
<section id="introducción" class="title-slide slide level1"
data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span>
Introducción</h1>

</section>
<section id="introducción-1" class="title-slide slide level2"
data-number="1.1">
<h2 data-number="1.1"><span class="header-section-number">1.1</span>
Introducción</h2>
<ul>
<li><p>Hemos visto que una buena modularidad se apoya en tres
conceptos:</p>
<ul>
<li><p><strong>Abstracción</strong>: los usuarios de un módulo necesitan
saber qué hace pero no cómo lo hace.</p></li>
<li><p><strong>Ocultación de información</strong>: los módulos deben
ocultar sus decisiones de diseño a sus usuarios.</p></li>
<li><p><strong>Independencia funcional</strong>: los módulos deben
dedicarse a alcanzar un único objetivo, con una alta cohesión entre sus
elementos y un bajo acoplamiento con el resto de los módulos.</p></li>
</ul></li>
<li><p>Vamos a estudiar con más detalle el primero de ellos: la
<strong>abstracción</strong>.</p></li>
</ul>
</section>
<section class="slide level5" data-number="1.1.0.0.1">

<ul>
<li><p>Hasta ahora hemos estudiado la abstracción como un proceso mental
que ayuda a estudiar, manipular y diseñar sistemas complejos
<em>destacando</em> los detalles relevantes e <em>ignorando</em>
momentáneamente los demás que ahora mismo no tienen importancia o no son
necesarios.</p></li>
<li><p>Asimismo, hemos visto que <strong>la abstracción se define por
niveles</strong>, es decir, que cuando estudiamos un sistema a un
determinado nivel:</p>
<ul>
<li><p><strong>Se <em>destacan</em> los detalles relevantes en ese
nivel</strong> (nos centramos en lo que es importante en ese
nivel).</p></li>
<li><p><strong>Se <em>ignoran</em> los detalles irrelevantes en ese
nivel</strong>. Si descendemos de nivel de abstracción, es probable que
algunos de esos detalles pasen a ser relevantes.</p></li>
</ul></li>
<li><p>Los programas son sistemas complejos, así que resulta importante
que el lenguaje de programación nos permita estudiar y diseñar programas
mediante sucesivos niveles de abstracción.</p></li>
</ul>
</section>
<section class="slide level5" data-number="1.1.0.0.2">

<ul>
<li><p>La abstracción es un <strong><em>proceso</em></strong> pero
también llamamos así al <strong><em>producto</em></strong> que se
obtiene como resultado de aplicar dicho proceso. Es algo que creamos y
que puede formar parte de un programa.</p></li>
<li><p>Hasta ahora, las únicas abstracciones que hemos utilizado y
creado son las <strong>funciones</strong>, también llamadas
<strong>abstracciones funcionales</strong>.</p></li>
<li><p><strong>Una función es una abstracción</strong> porque, para
usarla, el usuario sólo necesita conocer la
<strong>especificación</strong> de la abstracción (el <em>qué</em> hace)
y en ese momento puede ignorar el resto de los detalles de
<strong>implementación</strong> que se encuentran en el cuerpo de la
función (el <em>cómo</em> lo hace).</p></li>
<li><p>Por eso decimos que <strong>las funciones definen, al menos,
<em>dos niveles</em> de abstracción</strong>.</p></li>
<li><p>En otras palabras: al diseñar una función estamos creando una
abstracción que separa la forma en la que se utiliza la función de la
forma en como está implementada esa función.</p></li>
</ul>
</section>
<section class="slide level5" data-number="1.1.0.0.3">

<ul>
<li><p>Las abstracciones funcionales son un mecanismo que funciona
llevando a cabo estos pasos, en este orden:</p>
<ol>
<li><p><strong>Se compone una <em>instrucción compleja</em></strong>
combinando otras instrucciones más simples.</p></li>
<li><p><strong>Se le da un nombre</strong> a todo el conjunto.</p></li>
<li><p>A partir de ese momento, <strong>se puede usar esa nueva
instrucción compleja sin necesidad de conocer cómo está hecha por
dentro</strong>, es decir, sin necesidad de conocer cuáles son esas
instrucciones más simples que la forman (su <em>implementación</em>),
que son detalles que quedan ocultos al usuario.</p>
<p>Esa nueva instrucción compleja, a ojos del programador que la usa,
resulta prácticamente indistinguible de cualquier otra instrucción
predefinida del lenguaje.</p></li>
</ol></li>
<li><p>Una vez que la función se ha diseñado y se está utilizando, se
puede sustituir por cualquier otra que tenga el mismo comportamiento
observable.</p></li>
</ul>
</section>
<section class="slide level5" data-number="1.1.0.0.4">

<ul>
<li><p>Además de combinar operaciones, también podemos <strong>combinar
datos</strong>.</p></li>
<li><p>Los <strong>datos compuestos o estructurados</strong> son un
mecanismo que nos permite crear un <strong>dato complejo</strong>
combinando otros datos más simples, formando una única unidad
conceptual.</p></li>
<li><p>Pero, por desgracia, estos datos compuestos <strong>no ocultan
sus detalles de implementación al usuario</strong>, sino que éste tiene
que conocer cómo está construido.</p></li>
<li><p>Es decir: los datos compuestos, así sin más, no funcionan como
abstracciones.</p></li>
</ul>
</section>
<section class="slide level5" data-number="1.1.0.0.5">

<ul>
<li><p>Por ejemplo, podemos representar un número racional <span
class="math inline">\frac{a}{b}</span> mediante una pareja de números
enteros <span class="math inline">a</span> y <span
class="math inline">b</span> (su numerador y su denominador).</p></li>
<li><p>Si almacenamos los dos números por separado, no estaremos creando
una sola unidad conceptual (no estaremos componiendo un nuevo dato a
partir de otros datos más simples).</p></li>
<li><p>Eso no resulta conveniente. A nosotros, como programadores, nos
interesa que el numerador y el denominador de un número racional estén
juntos formando una sola cosa, un nuevo valor: un número
racional.</p></li>
<li><p>Además, si representamos un racional como dos números enteros
separados, no podríamos escribir una función que multiplique dos
racionales <span class="math inline">\frac{n_1}{d_1}</span> y <span
class="math inline">\frac{n_2}{d_2}</span> ya que dicha función tendría
que devolver dos valores (el numerador y el denominador del resultado),
cosa que no se puede:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mult_rac(n1, d1, n2, d2):</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ????</span></code></pre></div></li>
</ul>
</section>
<section class="slide level5" data-number="1.1.0.0.6">

<ul>
<li><p>Así que podríamos representar esa pareja de números usando un
único valor, mediante una lista como <code>[</code><span
class="math inline">a</span><code>,</code> <span
class="math inline">b</span><code>]</code>, o una tupla
<code>(</code><span class="math inline">a</span><code>,</code> <span
class="math inline">b</span><code>)</code>, o incluso un diccionario
 <code>{'numer':</code> <span
class="math inline">a</span><code>, 'denom':</code> <span
class="math inline">b</span><code>}</code>.</p></li>
<li><p>Esto está mejor, pero ahora estaríamos obligando al usuario de
nuestros números racionales a tener que saber cómo representamos los
racionales a partir de otros tipos más primitivos, lo que nos impedirá
cambiar luego esa representación sin afectar al resto del
programa.</p></li>
<li><p>Es decir: <strong>les estamos obligando a conocer detalles de
implementación</strong> de nuestros números racionales.</p></li>
<li><p>Por ejemplo, si representamos un racional <span
class="math inline">\frac{n}{d}</span> con una tupla <code>(</code><span
class="math inline">n</span><code>,</code> <span
class="math inline">d</span><code>)</code>, la función que multiplica
dos racionales podría ser:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mult_rac(r1, r2):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (r1[<span class="dv">0</span>] <span class="op">*</span> r2[<span class="dv">0</span>], r1[<span class="dv">1</span>] <span class="op">*</span> r2[<span class="dv">1</span>])</span></code></pre></div>
<p>Es decir, que la función tendría que saber que el racional se
representa internamente con una tupla, y que el numerador es el primer
elemento y que el denominador es el segundo elemento.</p></li>
</ul>
</section>
<section class="slide level5" data-number="1.1.0.0.7">

<ul>
<li><p>De hecho, si definiéramos la función usando anotaciones de tipos,
quedaría de la siguiente forma:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mult_rac(r1: <span class="bu">tuple</span>[<span class="bu">int</span>, <span class="bu">int</span>], r2: <span class="bu">tuple</span>[<span class="bu">int</span>, <span class="bu">int</span>]) <span class="op">-&gt;</span> <span class="bu">tuple</span>[<span class="bu">int</span>, <span class="bu">int</span>]:</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (r1[<span class="dv">0</span>] <span class="op">*</span> r2[<span class="dv">0</span>], r1[<span class="dv">1</span>] <span class="op">*</span> r2[<span class="dv">1</span>])</span></code></pre></div>
<p>lo que resalta aún más el hecho de que los racionales se representan
mediante tuplas de enteros, que es un detalle de
implementación.</p></li>
<li><p>De esta forma, tanto dentro como fuera de la función, el programa
tiene que conocer la representación interna de un racional.</p></li>
</ul>
</section>
<section class="slide level5" data-number="1.1.0.0.8">

<ul>
<li><p>En Python podemos definir <strong>sinónimos de tipos</strong>,
que son otros nombres para tipos ya existentes.</p></li>
<li><p>Con ello, <strong>no estaríamos creando un nuevo tipo</strong>,
sino más bien un nuevo nombre para otro tipo ya conocido.</p></li>
<li><p>Para ello, se usa la palabra clave <code>type</code>, indicando
el nuevo nombre del tipo y el tipo sobre el que se define, como si fuera
una sentencia de definición.</p></li>
<li><p>Por ejemplo, así definimos el tipo <code>rac</code> como el tipo
<em>tupla de dos enteros</em>:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span> rac <span class="op">=</span> <span class="bu">tuple</span>[<span class="bu">int</span>, <span class="bu">int</span>]</span></code></pre></div></li>
<li><p>Con este nuevo sinónimo de tipo, podemos definir la función
<code>mult_rac</code> de la siguiente forma:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mult_rac(r1: rac, r2: rac) <span class="op">-&gt;</span> rac:</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (r1[<span class="dv">0</span>] <span class="op">*</span> r2[<span class="dv">0</span>], r1[<span class="dv">1</span>] <span class="op">*</span> r2[<span class="dv">1</span>])</span></code></pre></div></li>
<li><p>Pero eso no impide el hecho de que <code>mult_rac</code> tiene
que saber que un racional es una tupla de dos enteros.</p></li>
</ul>
</section>
<section class="slide level5" data-number="1.1.0.0.9">

<ul>
<li><p>Nos interesa que nuestro programa sea capaz de expresar el
concepto de «número racional» y <strong>que pueda manipular números
racionales como valores con existencia propia y definida</strong>, no
simplemente como parejas de números enteros, <strong>independientemente
de su representación interna</strong>.</p></li>
<li><p>Para todo esto, es importante que el programa que utilice los
números racionales <strong>no necesite conocer los detalles
internos</strong> de cómo está representado internamente un número
racional.</p></li>
<li><p>Es decir: que los números racionales se pueden representar
internamente como una lista de dos números, o como una tupla, o como un
diccionario, o de cualquier otro modo, pero ese detalle interno debe
quedar oculto para los usuarios de los números racionales.</p></li>
</ul>
<div class="caja">
<p>La técnica general de aislar las partes de un programa que se ocupan
de <em>cómo se representan</em> los datos de las partes que se ocupan de
<em>cómo se usan</em> los datos es una poderosa metodología de diseño
llamada <strong>abstracción de datos</strong>.</p>
</div>
</section>
<section class="slide level5" data-number="1.1.0.0.10">

<ul>
<li><p>La <strong>abstracción de datos</strong> es una
<strong><em>técnica</em> de descomposición de programas en
módulos</strong>, pero también llamamos así al
<strong><em>producto</em></strong> que se obtiene como resultado de
aplicar dicha técnica.</p></li>
<li><p>Diseñar programas usando la técnica de la abstracción de datos da
como resultado la creación y utilización de <strong>tipos abstractos de
datos</strong> (o <strong>TAD</strong>), a los que también se les
denomina <strong>abstracciones de datos</strong>.</p></li>
<li><p>Por tanto, las abstracciones de datos son construcciones que
acaban formando parte del programa, de la misma manera que ocurre con
las abstracciones funcionales.</p></li>
<li><p>El objetivo es poder crear tipos de datos que se puedan usar de
la misma forma que los tipos predefinidos del lenguaje, es decir, sin
necesidad de saber cómo están hechos por dentro.</p></li>
</ul>
</section>
<section class="slide level5" data-number="1.1.0.0.11">

<ul>
<li><p>Por ejemplo, <code>set</code> es un tipo primitivo en Python que
actúa como un tipo abstracto de datos:</p>
<ul>
<li><p>Se nos proporcionan <strong>operaciones primitivas</strong> para
crear conjuntos y manipular conjuntos (unión, intersección, etc.) y
también un modo de visualizar sus valores.</p></li>
<li><p>Pero no sabemos, ni necesitamos saber, cómo se representan
internamente los conjuntos en la memoria del ordenador. Ese es un
detalle interno del intérprete.</p></li>
</ul></li>
<li><p>En general, el programador que usa un tipo abstracto puede no
saber (e incluso se le impide saber) cómo se representan los elementos
del tipo de datos.</p></li>
<li><p>Esa <strong>barrera de abstracción</strong> que se crea entre
cómo se usa y cómo se representa el tipo abstracto es muy útil porque
permite cambiar la representación interna sin afectar a las demás partes
del programa que utilizan dicho tipo abstracto.</p></li>
</ul>
</section>
<section class="slide level5" data-number="1.1.0.0.12">

<ul>
<li><p>La abstracción de datos se parece a la abstracción funcional:</p>
<ul>
<li><p>Cuando creamos una <strong>abstracción funcional</strong>, se
ocultan los detalles de cómo se implementa una función, y esa función
particular se puede sustituir luego por cualquier otra función que tenga
el mismo comportamiento general sin que los usuarios de la función se
vean afectados.</p>
<p>En otras palabras, podemos hacer una abstracción que separe la forma
en que <em>se utiliza</em> la función de los detalles de cómo <em>se
implementa</em> la función.</p></li>
<li><p>Igualmente, la <strong>abstracción de datos</strong> separa el
uso de un dato compuesto de los detalles de cómo está construido ese
dato compuesto, que quedan ocultos para los usuarios de la abstracción
de datos.</p></li>
</ul></li>
</ul>
<div class="caja">
<p>Para usar una abstracción de datos no necesitamos conocer sus
detalles internos de implementación.</p>
</div>
</section>
<section class="slide level5" data-number="1.1.0.0.13">

<table>
<colgroup>
<col style="width: 34%" />
<col style="width: 34%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Elementos del lenguaje</th>
<th style="text-align: left;">Instrucciones</th>
<th style="text-align: left;">Datos</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Primitivas</td>
<td style="text-align: left;">Definiciones y sentencias simples</td>
<td style="text-align: left;">Literales y datos simples (enteros,
reales, booleanos…)</td>
</tr>
<tr>
<td style="text-align: left;">Mecanismos de combinación</td>
<td style="text-align: left;">Expresiones y sentencias compuestas
(estructuras de control)</td>
<td style="text-align: left;">Datos compuestos (listas, tuplas…)</td>
</tr>
<tr>
<td style="text-align: left;">Mecanismos de abstracción</td>
<td style="text-align: left;">Abstracciones funcionales (funciones)</td>
<td style="text-align: left;">Abstracciones de datos (tipos
abstractos)</td>
</tr>
</tbody>
</table>
</section>
<section class="slide level5" data-number="1.1.0.0.14">

<ul>
<li><p>El concepto de <strong>abstracción de datos</strong> (o
<strong>tipo abstracto de datos</strong>) fue introducido formalmente
por primera vez por Barbara Liskov y Stephen Zilles en 1974 (aunque los
trabajos posteriores de John Guttag sobre <em>especificaciones
algebraicas</em> son muy importantes) y dice que:</p>
<div class="caja">
<p><strong>Tipo abstracto de datos</strong></p>
<p>Un <strong>tipo abstracto de datos</strong> (o
<strong><em>abstracción de datos</em></strong>) es un conjunto de
valores y de operaciones que se definen mediante una
<strong>especificación</strong> que es independiente de cualquier
representación.</p>
</div></li>
<li><p>Para ello, los tipos abstractos de datos se definen nombrando, no
sus valores, sino sus <strong>operaciones</strong> y las
<strong>propiedades</strong> que cumplen éstas.</p></li>
<li><p>Esto es así porque <strong>los <em>valores</em> de un tipo
abstracto se definen también como
<em>operaciones</em></strong>.</p></li>
</ul>
</section>
<section class="slide level5" data-number="1.1.0.0.15">

<ul>
<li><p><strong>Un tipo abstracto debe cumplir</strong> las siguientes
dos <strong>propiedades</strong>:</p>
<ul>
<li><p><strong>Privacidad de la representación</strong>: los usuarios no
conocen cómo se representan los valores del tipo abstracto en la memoria
del ordenador.</p></li>
<li><p><strong>Protección</strong>: sólo se pueden utilizar con sus
valores aquellas operaciones previstas en la especificación.</p></li>
</ul></li>
</ul>
</section>
<section class="slide level5" data-number="1.1.0.0.16">

<ul>
<li><p>El programador de un tipo abstracto debe crear, por tanto, dos
partes bien diferenciadas:</p>
<ol>
<li><p><strong>La <em>especificación</em> del tipo:</strong> única parte
que debe conocer el usuario del mismo y que consiste en:</p>
<ul>
<li><p>El <strong>nombre</strong> del tipo.</p></li>
<li><p>La especificación de las <strong>operaciones</strong> permitidas.
Esta especificación tendrá:</p>
<ul>
<li><p>Una parte <strong>sintáctica</strong>: la
<strong>signatura</strong> de cada operación.</p></li>
<li><p>Otra parte <strong>semántica</strong>, que define las
<strong>propiedades</strong> que deben cumplir dichas operaciones y que
se pueden expresar mediante <strong>ecuaciones</strong> o directamente
en lenguaje natural.</p></li>
</ul></li>
</ul></li>
<li><p><strong>La <em>implementación</em> del tipo:</strong> conocida
sólo por el programador del mismo y que consiste en la
<strong><em>representación</em> del tipo</strong> por medio de otros
tipos y en la <strong>implementación de las
operaciones</strong>.</p></li>
</ol></li>
</ul>
</section>
<section class="slide level5" data-number="1.1.0.0.17">

<blockquote>
<p>«Son las especificaciones, y no los programas, los que realmente
describen una abstracción; los programas simplemente la
implementan.»</p>
<p>– Barbara Liskov</p>
</blockquote>
</section>
</section>
<section>
<section id="especificaciones" class="title-slide slide level1"
data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span>
Especificaciones</h1>

</section>
<section id="sintaxis" class="title-slide slide level2"
data-number="2.1">
<h2 data-number="2.1"><span class="header-section-number">2.1</span>
Sintaxis</h2>
<ul>
<li>La especificación de un TAD usando expresiones formales (lógicas y
matemáticas) se denomina <strong>especificación
algebraica</strong>.</li>
</ul>
<p><br></p>
<div class="columns">
<div class="column" style="width:48%;">
<ul>
<li><p>Su sintaxis es la siguiente:</p>
<div class="line-block"><strong><code>espec</code></strong> <span
style="color:teal">⟨<em>tipo</em>⟩</span><br />
       [<strong><code>parámetros</code></strong><br />
             <span style="color:teal">⟨<em>parámetro</em>⟩</span><span
class="math inline">^+</span>]<br />
       <strong><code>operaciones</code></strong><br />
             (<span style="color:teal">⟨<em>operación</em>⟩</span>
<strong><code>:</code></strong> <span
style="color:teal">⟨<em>signatura</em>⟩</span>)<span
class="math inline">^+</span><br />
       [<strong><code>var</code></strong><br />
             <span style="color:teal">⟨<em>decl_var</em>⟩</span>
(<strong><code>;</code></strong> <span
style="color:teal">⟨<em>decl_var</em>⟩</span>)*]<br />
       <strong><code>ecuaciones</code></strong><br />
             <span style="color:teal">⟨<em>ecuación</em>⟩</span><span
class="math inline">^+</span></div></li>
</ul>
</div><div class="column" style="width:4%;">

</div><div class="column" style="width:48%;">
<ul>
<li><p>Donde:</p>
<div class="line-block"><span
style="color:teal">⟨<em>decl_var</em>⟩</span> ::= <span
style="color:teal">⟨<em>variable</em>⟩</span>
<strong><code>:</code></strong> <span
style="color:teal">⟨<em>tipo</em>⟩</span><br />
<span style="color:teal">⟨<em>ecuación</em>⟩</span> ::= <span
style="color:teal">⟨<em>izquierda</em>⟩</span> <span
class="math inline">\equiv</span> <span
style="color:teal">⟨<em>derecha</em>⟩</span></div></li>
<li><p>Las <strong>operaciones</strong> son <strong>abstracciones
funcionales</strong>.</p></li>
<li><p>Las <strong>ecuaciones</strong> son las
<strong>propiedades</strong> que deben cumplir las operaciones.</p></li>
</ul>
</div>
</div>
</section>

<section id="operaciones" class="title-slide slide level2"
data-number="2.2">
<h2 data-number="2.2"><span class="header-section-number">2.2</span>
Operaciones</h2>
<ul>
<li><p>Las operaciones que forman parte de la especificación de un tipo
abstracto <span class="math inline">T</span> pueden clasificarse en
estas categorías:</p>
<ul>
<li><p><strong>Constructoras</strong>: operaciones que devuelven un
valor de tipo <span class="math inline">T</span>.</p>
<p>A su vez, las constructoras se dividen en:</p>
<ul>
<li><p><strong>Generadoras</strong>: son aquellas operaciones
constructoras que tienen la propiedad de que sólo con ellas es
suficiente para generar cualquier valor del tipo, y excluyendo
cualquiera de ellas hay valores que no pueden ser generados.</p></li>
<li><p><strong>Modificadoras</strong>: son las operaciones constructoras
que no forman parte del conjunto de las generadoras.</p></li>
</ul></li>
<li><p><strong>Selectoras</strong>: operaciones que toman como argumento
uno o más valores de tipo <span class="math inline">T</span> y que NO
devuelven un valor de tipo <span class="math inline">T</span>.</p></li>
</ul></li>
</ul>
</section>
<section id="ejemplo" class="slide level5 unnumbered unlisted">
<h5 class="unnumbered unlisted">Ejemplo</h5>
<div class="columns">
<div class="column" style="width:48%;">
<div class="line-block"><strong>espec</strong> <em>lista</em><br />
<strong>parámetros</strong><br />
      <em>elemento</em><br />
<strong>operaciones</strong><br />
      <code>[]</code> : <span class="math inline">\rightarrow</span>
<em>lista</em><br />
      <code>[</code>_<code>]</code> : <em>elemento</em> <span
class="math inline">\rightarrow</span> <em>lista</em><br />
      _<code>++</code>_ : <em>lista</em> <span
class="math inline">\times</span> <em>lista</em> <span
class="math inline">\rightarrow</span> <em>lista</em><br />
      _<code>:</code>_ : <em>elemento</em> <span
class="math inline">\times</span> <em>lista</em> <span
class="math inline">\rightarrow</span> <em>lista</em><br />
      <code>len</code> : <em>lista</em> <span
class="math inline">\rightarrow</span> <span
class="math inline">\mathbb{N}</span><br />
<strong>var</strong><br />
      <span class="math inline">x</span> : <em>elemento</em>; <span
class="math inline">l, l_1, l_2, l_3</span> : <em>lista</em><br />
<strong>ecuaciones</strong><br />
      <span class="math inline">x</span> <code>:</code> <span
class="math inline">l</span> <span class="math inline">\equiv</span>
<code>[</code><span class="math inline">x</span><code>]</code>
<code>++</code> <span class="math inline">l</span><br />
      <code>[</code><span class="math inline">x</span><code>]</code>
<span class="math inline">\equiv</span> <span
class="math inline">x</span> <code>:</code> <code>[]</code><br />
      <span class="math inline">l</span> <code>++</code> <code>[]</code>
<span class="math inline">\equiv</span> <span
class="math inline">l</span><br />
      <code>[]</code> <code>++</code> <span class="math inline">l</span>
<span class="math inline">\equiv</span> <span
class="math inline">l</span><br />
      (<span class="math inline">x</span> <code>:</code> <span
class="math inline">l_1</span>) <code>++</code> <span
class="math inline">l_2</span> <span class="math inline">\equiv</span>
<span class="math inline">x</span> <code>:</code> (<span
class="math inline">l_1</span> <code>++</code> <span
class="math inline">l_2</span>)<br />
      (<span class="math inline">l_1</span> <code>++</code> <span
class="math inline">l_2</span>) <code>++</code> <span
class="math inline">l_3</span> <span class="math inline">\equiv</span>
<span class="math inline">l_1</span> <code>++</code> (<span
class="math inline">l_2</span> <code>++</code> <span
class="math inline">l_3</span>)<br />
      <code>len</code>(<code>[]</code>) <span
class="math inline">\equiv</span> 0<br />
      <code>len</code>(<code>[</code><span
class="math inline">x</span><code>]</code>) <span
class="math inline">\equiv</span> 1<br />
      <code>len</code>(<span class="math inline">x</span> <code>:</code>
<span class="math inline">l</span>) <span
class="math inline">\equiv</span> 1 + <code>len</code>(<span
class="math inline">l</span>)<br />
      <code>len</code>(<span class="math inline">l_1</span>
<code>++</code> <span class="math inline">l_2</span>) <span
class="math inline">\equiv</span> <code>len</code>(<span
class="math inline">l_1</span>) + <code>len</code>(<span
class="math inline">l_2</span>)</div>
</div><div class="column" style="width:4%;">

</div><div class="column" style="width:48%;">
<ul>
<li><p>Este es un ejemplo de especificación de las
<strong>listas</strong> como tipo abstracto.</p></li>
<li><p>La ecuación <span class="math inline">t_1 \equiv t_2</span>
significa que el valor construido mediante <span
class="math inline">t_1</span> es <em>el mismo</em> que el construido
mediante <span class="math inline">t_2</span>.</p></li>
<li><p>Los <em>parámetros</em> son variables que representan cualquier
tipo.</p></li>
<li><p>Este estilo de especificación se denomina <strong>especificación
algebraica</strong>.</p></li>
<li><p>Su principal virtud es que permite definir un nuevo tipo de forma
<em>totalmente independiente</em> de cualquier posible
representación.</p></li>
</ul>
</div>
</div>
</section>
<section id="ejercicio" class="slide level5 unnumbered unlisted">
<h5 class="unnumbered unlisted">Ejercicio</h5>
<ol class="example" type="1">
<li>¿A qué categoría pertenencen cada una de esas operaciones?</li>
</ol>
</section>
<section class="slide level5" data-number="2.2.0.0.1">

<ul>
<li><p>Según esta especificación, cualquier lista se puede construir
usando únicamente las operaciones <code>[]</code> y _<code>:</code>_,
que son, por tanto, las operaciones <em>generadoras</em> del
TAD.</p></li>
<li><p>Por ejemplo, la lista que escribiríamos en Python como
<code>[1, 2, 3]</code> se construiría <code>1:(2:(3:[]))</code>,
combinando ambas operaciones, de forma que la sintaxis de Python sería
sencillamente un <em>azúcar sintáctico</em> para representar listas de
una forma más cómoda.</p></li>
<li><p>Lo interesante de estas operaciones es que no se simplifican más,
es decir, que <code>[]</code> coincide con su forma normal y que (<span
class="math inline">x</span> <code>:</code> <span
class="math inline">l</span>) también coincide con su forma normal para
cualquier valor de <span class="math inline">\underline{x}</span> y
<span class="math inline">\underline{l}</span>.</p></li>
<li><p>Por otra parte, las listas definidas según esta especificación no
resultan muy útiles, ya que podemos crear listas de elementos pero no
disponemos de ninguna operación que nos permita luego acceder a esos
elementos.</p></li>
</ul>
</section>
<section class="slide level5" data-number="2.2.0.0.2">

<ul>
<li><p>Al definir y usar abstracciones de datos, seguiremos el enfoque
propio de la <strong>programación funcional</strong>, donde:</p>
<ul>
<li><p><strong>No existe mutabilidad</strong> ni estado interno ni
cambios de estado.</p></li>
<li><p>En lugar de cambiar el estado de un dato compuesto, se crea un
nuevo dato con los cambios aplicados.</p></li>
</ul></li>
<li><p>Por ejemplo: la operación <code>:</code> (que añade un elemento
al principio de una lista) realmente no modifica dicha lista sino que
crea una nueva lista con el elemento situado al principio, y la
devuelve.</p></li>
<li><p>Esto lo podemos expresar en la especificación de la lista con la
siguiente ecuación (siendo <span
class="math inline">\underline{x}</span> un elemento y <span
class="math inline">\underline{l}</span> una lista):</p>
<p><span class="math inline">x</span> <code>:</code> <span
class="math inline">l</span> <span class="math inline">\equiv</span>
<code>[</code><span class="math inline">x</span><code>]</code>
<code>++</code> <span class="math inline">l</span></p>
<p>Se puede observar que no se modifica la lista <span
class="math inline">\underline{l}</span> para añadir el elemento <span
class="math inline">\underline{x}</span> al principio, sino que se crea
una lista nueva por concatenación de otras dos.</p></li>
</ul>
</section>
<section class="slide level5" data-number="2.2.0.0.3">

<ul>
<li><p>¿Crees que hay ecuaciones que sobran? ¿Se podría crear una
especificación equivalente pero más corta, de forma que tenga menos
ecuaciones pero que se comporte exactamente igual que la
anterior?</p></li>
<li><p>En realidad, en la especificación anterior hay ecuaciones que no
son estrictamente necesarias ya que se pueden deducir a partir de otras
que sí lo son:</p>
<ul>
<li><p>Las ecuaciones que son necesarias representan
<strong>axiomas</strong> de nuestro sistema.</p></li>
<li><p>Las ecuaciones que se pueden deducir de otras representan
<strong>teoremas</strong> de nuestro sistema.</p></li>
</ul></li>
<li><p>Bastaría con tener una especificación algebraica basada en
axiomas y que dependan únicamente de operaciones generadoras.</p></li>
</ul>
</section>
<section class="slide level5" data-number="2.2.0.0.4">

<div class="columns">
<div class="column" style="width:42%;">
<div class="line-block"><strong>espec</strong> <em>lista</em><br />
<strong>parámetros</strong><br />
      <em>elemento</em><br />
<strong>operaciones</strong><br />
      <code>[]</code> : <span class="math inline">\rightarrow</span>
<em>lista</em><br />
      _<code>:</code>_ : <em>elemento</em> <span
class="math inline">\times</span> <em>lista</em> <span
class="math inline">\rightarrow</span> <em>lista</em><br />
      <code>[</code>_<code>]</code> : <em>elemento</em> <span
class="math inline">\rightarrow</span> <em>lista</em><br />
      _<code>++</code>_ : <em>lista</em> <span
class="math inline">\times</span> <em>lista</em> <span
class="math inline">\rightarrow</span> <em>lista</em><br />
      <code>len</code> : <em>lista</em> <span
class="math inline">\rightarrow</span> <span
class="math inline">\mathbb{N}</span><br />
<strong>var</strong><br />
      <span class="math inline">x</span> : <em>elemento</em>; <span
class="math inline">l, l_1, l_2</span> : <em>lista</em><br />
<strong>ecuaciones</strong><br />
      <code>[</code><span class="math inline">x</span><code>]</code>
<span class="math inline">\equiv</span> <span
class="math inline">x</span> <code>:</code> <code>[]</code><br />
      <code>[]</code> <code>++</code> <span class="math inline">l</span>
<span class="math inline">\equiv</span> <span
class="math inline">l</span><br />
      (<span class="math inline">x</span> <code>:</code> <span
class="math inline">l_1</span>) <code>++</code> <span
class="math inline">l_2</span> <span class="math inline">\equiv</span>
<span class="math inline">x</span> <code>:</code> (<span
class="math inline">l_1</span> <code>++</code> <span
class="math inline">l_2</span>)<br />
      <code>len</code>(<code>[]</code>) <span
class="math inline">\equiv</span> 0<br />
      <code>len</code>(<span class="math inline">x</span> <code>:</code>
<span class="math inline">l</span>) <span
class="math inline">\equiv</span> 1 + <code>len</code>(<span
class="math inline">l</span>)</div>
</div><div class="column" style="width:2%;">

</div><div class="column" style="width:56%;">
<ul>
<li><p>En el ejemplo de las listas, las <strong>operaciones
generadoras</strong> son <code>[]</code> y _<code>:</code>_.</p></li>
<li><p>El resto de las operaciones se definen a partir de
ellas.</p></li>
<li><p>Las ecuaciones que aparecen ahora en esta especificación son los
<strong>axiomas</strong> de la misma, y las que hemos quitado son
<strong>teoremas</strong> que se pueden deducir (es decir,
<em>demostrar</em>) a partir de otras ecuaciones.</p></li>
<li><p>Al final, todos los teoremas se deben poder deducir de los
axiomas, directa o indirectamente.</p></li>
</ul>
</div>
</div>
</section>
<section class="slide level5" data-number="2.2.0.0.5">

<ul>
<li><p>Por ejemplo, supongamos que queremos demostrar que se cumple la
siguiente ecuación (que apareció antes en la primera especificación de
<em>lista</em>):</p>
<div class="centered">
<p><span class="math inline">l</span> <code>++</code> <code>[]</code>
<span class="math inline">\equiv</span> <span
class="math inline">l</span></p>
</div>
<p>siendo <span class="math inline">\underline{l}</span> una lista
cualquiera.</p></li>
<li><p>Para ello, tenemos que recordar que una lista, según nuestra
especificación, sólo puede tener dos formas posibles:</p>
<ul>
<li><p>Una lista vacía:</p>
<p><code>[]</code></p></li>
<li><p>Un elemento seguido de otra lista:</p>
<p><span class="math inline">x</span> <code>:</code> <span
class="math inline">l_1</span></p></li>
</ul>
<p>Cualquier lista se puede construir combinando sólo estas dos
operaciones.</p></li>
<li><p>Por ejemplo, la lista <code>[1, 2, 3]</code> es
<code>1:(2:(3:[]))</code>.</p></li>
</ul>
</section>
<section class="slide level5" data-number="2.2.0.0.6">

<ul>
<li><p>Se puede demostrar por inducción sobre <span
class="math inline">l</span>, a partir de los axiomas de la
especificación de <em>lista</em>:</p>
<ol type="a">
<li><p>Caso <span class="math inline">l</span> = <code>[]</code> (caso
base):</p>
<table style="width:81%;">
<colgroup>
<col style="width: 33%" />
<col style="width: 47%" />
</colgroup>
<tbody>
<tr>
<td style="text-align: left;"><span class="math inline">l</span>
<code>++</code> <code>[]</code></td>
<td style="text-align: left;"># <em>por definición de <span
class="math inline">l</span></em></td>
</tr>
<tr>
<td style="text-align: left;"><span class="math inline">\equiv</span>
<code>[]</code> <code>++</code> <code>[]</code></td>
<td style="text-align: left;"># <em>por el primer axioma de
<code>++</code></em></td>
</tr>
<tr>
<td style="text-align: left;"><span class="math inline">\equiv</span>
<code>[]</code></td>
<td style="text-align: left;"># <em>por definición de <span
class="math inline">l</span></em></td>
</tr>
<tr>
<td style="text-align: left;"><span class="math inline">\equiv</span>
<span class="math inline">l</span></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table></li>
<li><p>Caso <span class="math inline">l</span> = <span
class="math inline">x</span> <code>:</code> <span
class="math inline">l_1</span> (caso inductivo):</p>
<p>Suponemos que la propiedad se cumple para <span
class="math inline">l_1</span> (hipótesis inductiva), es decir, que
<span class="math inline">l_1</span> <code>++</code> <code>[]</code>
<span class="math inline">\equiv</span> <span
class="math inline">l_1</span>. En tal caso, tenemos:</p>
<table style="width:97%;">
<colgroup>
<col style="width: 48%" />
<col style="width: 48%" />
</colgroup>
<tbody>
<tr>
<td style="text-align: left;"><span class="math inline">l</span>
<code>++</code> <code>[]</code></td>
<td style="text-align: left;"># <em>por definición de <span
class="math inline">l</span></em></td>
</tr>
<tr>
<td style="text-align: left;"><span class="math inline">\equiv</span>
(<span class="math inline">x</span> <code>:</code> <span
class="math inline">l_1</span>) <code>++</code> <code>[]</code></td>
<td style="text-align: left;"># <em>por el segundo axioma de
<code>++</code></em></td>
</tr>
<tr>
<td style="text-align: left;"><span class="math inline">\equiv</span>
<span class="math inline">x</span> <code>:</code> (<span
class="math inline">l_1</span> <code>++</code> <code>[]</code>)</td>
<td style="text-align: left;"># <em>por hipótesis inductiva</em></td>
</tr>
<tr>
<td style="text-align: left;"><span class="math inline">\equiv</span>
<span class="math inline">x</span> <code>:</code> <span
class="math inline">l_1</span></td>
<td style="text-align: left;"># <em>por definición de <span
class="math inline">l</span></em></td>
</tr>
<tr>
<td style="text-align: left;"><span class="math inline">\equiv</span>
<span class="math inline">l</span></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table></li>
</ol></li>
</ul>
</section>
<section class="slide level5" data-number="2.2.0.0.7">

<ul>
<li>Como hemos demostrado que <span class="math inline">l</span>
<code>++</code> <code>[]</code> <span class="math inline">\equiv</span>
<span class="math inline">l</span> para cualquiera de las dos formas
posibles que puede tener <span class="math inline">l</span>, hemos
logrado demostrar la propiedad para cualquier valor de <span
class="math inline">l</span>.</li>
</ul>
</section>
<section class="slide level5" data-number="2.2.0.0.8">

<div class="columns">
<div class="column" style="width:48%;">
<ul>
<li>Las <strong>pilas</strong> como tipo abstracto se podrían
especificar así:</li>
</ul>
<div class="line-block"><strong>espec</strong> <em>pila</em><br />
<strong>parámetros</strong><br />
      <em>elemento</em><br />
<strong>operaciones</strong><br />
      <code>pvacia</code> : <span class="math inline">\rightarrow</span>
<em>pila</em><br />
      <code>apilar</code> : <em>pila</em> <span
class="math inline">\times</span> <em>elemento</em> <span
class="math inline">\rightarrow</span> <em>pila</em><br />
      <strong>parcial</strong> <code>cima</code> : <em>pila</em> <span
class="math inline">\rightarrow</span> <em>elemento</em><br />
      <strong>parcial</strong> <code>desapilar</code> : <em>pila</em>
<span class="math inline">\rightarrow</span> <em>pila</em><br />
      <code>vacia?</code> : <em>pila</em> <span
class="math inline">\rightarrow</span> <span
class="math inline">\mathbb{B}</span><br />
<strong>var</strong><br />
      <span class="math inline">p</span> : <em>pila</em>; <span
class="math inline">x</span> : <em>elemento</em><br />
<strong>ecuaciones</strong><br />
      <code>cima</code>(<code>apilar</code>(<span
class="math inline">p</span>, <span class="math inline">x</span>)) <span
class="math inline">\equiv</span> <span
class="math inline">x</span><br />
      <code>desapilar</code>(<code>apilar</code>(<span
class="math inline">p</span>, <span class="math inline">x</span>)) <span
class="math inline">\equiv</span> <span
class="math inline">p</span><br />
      <code>vacia?</code>(<code>pvacia</code>) <span
class="math inline">\equiv</span> <span
class="math inline">V</span><br />
      <code>vacia?</code>(<code>apilar</code>(<span
class="math inline">p</span>, <span class="math inline">x</span>)) <span
class="math inline">\equiv</span> <span
class="math inline">F</span><br />
      <code>cima</code>(<code>pvacia</code>) <span
class="math inline">\equiv</span> <strong>error</strong><br />
      <code>desapilar</code>(<code>pvacia</code>) <span
class="math inline">\equiv</span> <strong>error</strong></div>
</div><div class="column" style="width:4%;">

</div><div class="column" style="width:48%;">
<ul>
<li><p>En esta especificación aparecen <strong>operaciones
<em>parciales</em></strong>, que son aquellas que no se pueden aplicar a
todos los valores posibles.</p></li>
<li><p>Por ejemplo, no se puede (no tiene sentido) calcular la cima de
una pila vacía o desapilar una pila vacía. En ambos casos obtenemos un
error (marcado en las ecuaciones con la etiqueta
<strong>error</strong>).</p></li>
<li><p>Por tanto, ambas operaciones son <em>parciales</em>, porque no se
pueden aplicar sobre cualquier tipo de pila (sólo se puede aplicar sobre
las pilas <em>no vacías</em>).</p></li>
</ul>
</div>
</div>
</section>
<section class="slide level5" data-number="2.2.0.0.9">

<ul>
<li><p>Una operación es <em>parcial</em> cuando su
<strong><em>dominio</em></strong> no coincide con su
<strong><em>conjunto origen</em></strong>.</p></li>
<li><p>Por ejemplo <code>cima</code> es una operación parcial porque su
cojunto origen es <em>pila</em>, pero su dominio no contiene a todas las
pilas, ya que no está definida para el valor <code>pvacia</code> (que
también es una pila).</p></li>
<li><p>Por tanto, el dominio de <code>cima</code> es ( <em>pila</em>
<span class="math inline">\setminus\ \{</span> <code>pvacia</code> <span
class="math inline">\}</span> ).</p></li>
<li><p>Las operaciones que no son parciales se denominan
<strong>operaciones <em>totales</em></strong>.</p></li>
<li><p>En teoría, cualquier operación parcial se podría convertir en
total si cambiáramos su conjunto origen para hacer que coincida
exactamente con su dominio.</p></li>
<li><p>De esta forma, podríamos hacer que <code>cima</code> sea total si
la definimos con la siguiente signatura:</p>
<div class="centered">
<p><code>cima</code> : <em>pila</em> <span
class="math inline">\setminus\ \{</span> <code>pvacia</code> <span
class="math inline">\}</span> <span
class="math inline">\rightarrow</span> <em>elemento</em></p>
</div></li>
<li><p>El problema es que eso no resulta práctico porque normalmente los
lenguajes de programación no permiten definir operaciones de esta
manera.</p></li>
</ul>
</section>
<section class="slide level5" data-number="2.2.0.0.10">

<ul>
<li><p>Un programa que hiciera uso de las pilas, una vez implementado el
tipo abstracto de datos, podría ser:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> pvacia()        <span class="co"># crea una pila vacía</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> apilar(p, <span class="dv">4</span>)    <span class="co"># apila el valor 4 en la pila p</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> apilar(p, <span class="dv">8</span>)    <span class="co"># apila el valor 8 en la pila p</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(vacia(p))     <span class="co"># imprime False</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cima(p))      <span class="co"># imprime 8</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> desapilar(p)    <span class="co"># desapila el valor 8 de la pila p</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cima(p))      <span class="co"># imprime 4</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> desapilar(p)    <span class="co"># desapila el valor 4 de la pila p</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(vacia(p))     <span class="co"># imprime True</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cima(pvacia)) <span class="co"># error</span></span></code></pre></div></li>
<li><p>El programa usa la pila a través de las operaciones sin necesidad
de conocer su representación interna (su implementación).</p>
<p>Es decir: no necesitamos saber cómo está hecha la pila por dentro, ni
cómo están programadas las funciones <code>pvacia</code>,
<code>apilar</code>, <code>cima</code> y <code>desapilar</code>.</p>
<p>Nos basta con saber las propiedades que deben cumplir esas funciones,
y eso viene definido en la especificación.</p></li>
</ul>
</section>
<section class="slide level5" data-number="2.2.0.0.11">

<div class="columns">
<div class="column" style="width:48%;">
<ul>
<li><p>Sabiendo ahora lo que son las operaciones parciales, podemos
definir una especificación del tipo <em>lista</em> que nos permita
acceder a sus elementos.</p></li>
<li><p>Para ello, definiremos dos operaciones más llamadas
<code>primero</code> y <code>resto</code> que nos devuelvan el primer
elemento y el resto de la lista, respectivamente.</p></li>
<li><p><code>primero</code> es selectora y <code>resto</code> es
modificadora.</p></li>
<li><p>Pero esas dos operaciones sólo funcionan si la lista no está
vacía, así que son operaciones <em>parciales</em>.</p></li>
</ul>
</div><div class="column" style="width:4%;">

</div><div class="column" style="width:48%;">
<div class="line-block"><strong>espec</strong> <em>lista</em><br />
<strong>parámetros</strong><br />
      <em>elemento</em><br />
<strong>operaciones</strong><br />
      <code>[]</code> : <span class="math inline">\rightarrow</span>
<em>lista</em><br />
      _<code>:</code>_ : <em>elemento</em> <span
class="math inline">\times</span> <em>lista</em> <span
class="math inline">\rightarrow</span> <em>lista</em><br />
      <code>[</code>_<code>]</code> : <em>elemento</em> <span
class="math inline">\rightarrow</span> <em>lista</em><br />
      _<code>++</code>_ : <em>lista</em> <span
class="math inline">\times</span> <em>lista</em> <span
class="math inline">\rightarrow</span> <em>lista</em><br />
      <strong>parcial</strong> <code>primero</code> : <em>lista</em>
<span class="math inline">\rightarrow</span> <em>elemento</em><br />
      <strong>parcial</strong> <code>resto</code> : <em>lista</em> <span
class="math inline">\rightarrow</span> <em>lista</em><br />
      <code>len</code> : <em>lista</em> <span
class="math inline">\rightarrow</span> <span
class="math inline">\mathbb{N}</span><br />
<strong>var</strong><br />
      <span class="math inline">x</span> : <em>elemento</em>; <span
class="math inline">l, l_1, l_2</span> : <em>lista</em><br />
<strong>ecuaciones</strong><br />
      <code>[</code><span class="math inline">x</span><code>]</code>
<span class="math inline">\equiv</span> <span
class="math inline">x</span> <code>:</code> <code>[]</code><br />
      <code>[]</code> <code>++</code> <span class="math inline">l</span>
<span class="math inline">\equiv</span> <span
class="math inline">l</span><br />
      (<span class="math inline">x</span> <code>:</code> <span
class="math inline">l_1</span>) <code>++</code> <span
class="math inline">l_2</span> <span class="math inline">\equiv</span>
<span class="math inline">x</span> <code>:</code> (<span
class="math inline">l_1</span> <code>++</code> <span
class="math inline">l_2</span>)<br />
      <code>primero</code>(<code>[]</code>) <span
class="math inline">\equiv</span> <strong>error</strong><br />
      <code>primero</code>(<span class="math inline">x</span>
<code>:</code> <span class="math inline">l</span>) <span
class="math inline">\equiv</span> <span
class="math inline">x</span><br />
      <code>resto</code>(<code>[]</code>) <span
class="math inline">\equiv</span> <strong>error</strong><br />
      <code>resto</code>(<span class="math inline">x</span>
<code>:</code> <span class="math inline">l</span>) <span
class="math inline">\equiv</span> <span
class="math inline">l</span><br />
      <code>len</code>(<code>[]</code>) <span
class="math inline">\equiv</span> 0<br />
      <code>len</code>(<span class="math inline">x</span> <code>:</code>
<span class="math inline">l</span>) <span
class="math inline">\equiv</span> 1 + <code>len</code>(<span
class="math inline">l</span>)</div>
</div>
</div>
</section>
<section class="slide level5" data-number="2.2.0.0.12">

<ul>
<li>Los <strong>números racionales</strong> se podrían especificar
así:</li>
</ul>
<div class="line-block"><strong>espec</strong> <em>rac</em><br />
<strong>operaciones</strong><br />
      <strong>parcial</strong> <code>racional</code> : <span
class="math inline">\mathbb{Z}</span> <span
class="math inline">\times</span> <span
class="math inline">\mathbb{Z}</span> <span
class="math inline">\rightarrow</span> <em>rac</em><br />
      <code>numer</code> : <em>rac</em> <span
class="math inline">\rightarrow</span> <span
class="math inline">\mathbb{Z}</span><br />
      <code>denom</code> : <em>rac</em> <span
class="math inline">\rightarrow</span> <span
class="math inline">\mathbb{Z}</span><br />
      <code>suma</code> : <em>rac</em> <span
class="math inline">\times</span> <em>rac</em> <span
class="math inline">\rightarrow</span> <em>rac</em><br />
      <code>mult</code> : <em>rac</em> <span
class="math inline">\times</span> <em>rac</em> <span
class="math inline">\rightarrow</span> <em>rac</em><br />
      <code>iguales?</code> : <em>rac</em> <span
class="math inline">\times</span> <em>rac</em> <span
class="math inline">\rightarrow</span> <span
class="math inline">\mathbb{B}</span><br />
      <code>imprimir</code> : <em>rac</em> <span
class="math inline">\rightarrow</span> <span
class="math inline">\emptyset</span><br />
<strong>var</strong><br />
      <span class="math inline">r</span> : <em>rac</em>; <span
class="math inline">n</span>, <span class="math inline">d</span>, <span
class="math inline">n_1</span>, <span class="math inline">n_2</span>,
<span class="math inline">d_1</span>, <span
class="math inline">d_2</span> : <span
class="math inline">\mathbb{Z}</span><br />
<strong>ecuaciones</strong><br />
      <code>numer</code>(<code>racional</code>(<span
class="math inline">n</span>, <span class="math inline">d</span>)) <span
class="math inline">\equiv</span> <span
class="math inline">n</span><br />
      <code>denom</code>(<code>racional</code>(<span
class="math inline">n</span>, <span class="math inline">d</span>)) <span
class="math inline">\equiv</span> <span
class="math inline">d</span><br />
      <code>suma</code>(<code>racional</code>(<span
class="math inline">n_1</span>, <span class="math inline">d_1</span>),
<code>racional</code>(<span class="math inline">n_2</span>, <span
class="math inline">d_2</span>)) <span class="math inline">\equiv</span>
<code>racional</code>(<span class="math inline">n_1\cdot{}d_2 +
n_2\cdot{}d_1</span>, <span
class="math inline">d_1\cdot{}d_2</span>)<br />
      <code>mult</code>(<code>racional</code>(<span
class="math inline">n_1</span>, <span class="math inline">d_1</span>),
<code>racional</code>(<span class="math inline">n_2</span>, <span
class="math inline">d_2</span>)) <span class="math inline">\equiv</span>
<code>racional</code>(<span class="math inline">n_1\cdot{}n_2</span>,
<span class="math inline">d_1\cdot{}d_2</span>)<br />
      <code>iguales?</code>(<code>racional</code>(<span
class="math inline">n_1</span>, <span class="math inline">d_1</span>),
<code>racional</code>(<span class="math inline">n_2</span>, <span
class="math inline">d_2</span>)) <span class="math inline">\equiv</span>
<span class="math inline">n_1\cdot{}d_2 = n_2\cdot{}d_1</span><br />
      <code>imprimir</code>(<span class="math inline">r</span>)   {
imprime el racional <span class="math inline">r</span> }<br />
      <code>racional</code>(<span class="math inline">n</span>, 0) <span
class="math inline">\equiv</span> <strong>error</strong></div>
</section>
<section class="slide level5" data-number="2.2.0.0.13">

<ul>
<li><p>La operación <code>imprimir</code> es un caso especial, ya que
<strong>no es una operación <em>pura</em></strong>, sino que su
finalidad es la de provocar el <strong>efecto lateral</strong> de
imprimir por la salida un número racional de forma «bonita».</p></li>
<li><p>Por eso no devuelve ningún valor, cosa que se refleja en su
signatura usando <span class="math inline">\emptyset</span> como tipo de
retorno de la operación:</p></li>
</ul>
<p><code>imprimir</code> : <em>rac</em> <span
class="math inline">\rightarrow</span> <span
class="math inline">\emptyset</span></p>
<ul>
<li>Y el <em>efecto</em> que produce se indica entre llaves en el
apartado de ecuaciones:</li>
</ul>
<p><code>imprimir</code>(<span class="math inline">r</span>)   { imprime
el racional <span class="math inline">r</span> }</p>
<ul>
<li>Introducir <strong>operaciones <em>impuras</em></strong> amplía la
funcionalidad de nuestro tipo abstracto, pero hay que tener cuidado
porque se pierde la transparencia referencial y, con ello, nuestra
capacidad para razonar matemáticamente sobre las especificaciones.</li>
</ul>
</section>
<section class="slide level5" data-number="2.2.0.0.14">

<ul>
<li><p>Según la especificación anterior, podemos suponer que disponemos
de un constructor y dos selectores a través de las siguientes
funciones:</p>
<ul>
<li><p><code>racional(</code><span
class="math inline">n</span><code>,</code><span
class="math inline">d</span><code>)</code>: devuelve el número racional
con numerador <span class="math inline">n</span> y denominador <span
class="math inline">d</span>.</p></li>
<li><p><code>numer(</code><span
class="math inline">x</span><code>)</code>: devuelve el numerador del
número racional <span class="math inline">x</span>.</p></li>
<li><p><code>denom(</code><span
class="math inline">x</span><code>)</code>: devuelve el denominador del
número racional <span class="math inline">x</span>.</p></li>
</ul></li>
<li><p>Todas las demás operaciones se podrían definir como funciones a
partir de éstas tres.</p></li>
<li><p>Estamos usando una estrategia poderosa para diseñar programas: el
<strong>pensamiento optimista</strong>, ya que todavía no hemos dicho
cómo se representa un número racional, o cómo se deben implementar las
funciones <code>numer</code>, <code>denom</code> y
<code>racional</code>.</p></li>
<li><p>Nos basta con saber <em>qué</em> hacen y <em>suponer</em> que ya
las tenemos.</p></li>
</ul>
</section>
<section class="slide level5" data-number="2.2.0.0.15">

<ul>
<li><p>Así, podemos definir las funciones <code>suma</code>,
<code>mult</code>, <code>imprimir</code> e <code>iguales?</code> a
partir de <code>racional</code>, <code>numer</code> y <code>denom</code>
sin necesidad de saber cómo están implementadas esas tres funciones ni
cómo se representa internamente un número racional.</p></li>
<li><p>Esos detalles de implementación quedan ocultos y son innecesarios
para definir las funciones <code>suma</code>, <code>mult</code>,
<code>imprimir</code> e <code>iguales?</code>, ya que bastaría con saber
<em>qué</em> hacen las funciones <code>racional</code>,
<code>numer</code> y <code>denom</code> y no <em>cómo</em> lo
hacen.</p></li>
<li><p>Hasta el punto de que ni siquiera hace falta tener implementadas
ya las funciones <code>racional</code>, <code>numer</code> y
<code>denom</code> para poder definir las demás.
<strong>Suponemos</strong> que las tenemos (<em>pensamiento
optimista</em>).</p></li>
</ul>
</section>
</section>
<section>
<section id="implementaciones" class="title-slide slide level1"
data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span>
Implementaciones</h1>

</section>
<section id="implementaciones-1" class="title-slide slide level2"
data-number="3.1">
<h2 data-number="3.1"><span class="header-section-number">3.1</span>
Implementaciones</h2>
<ul>
<li><p>Una posible implementación en Python de las operaciones
<code>suma</code>, <code>mult</code>, <code>imprimir</code> e
<code>iguales?</code> a partir de <code>racional</code>,
<code>numer</code> y <code>denom</code> podría ser la siguiente:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> suma(x, y):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    nx, dx <span class="op">=</span> numer(x), denom(x)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    ny, dy <span class="op">=</span> numer(y), denom(y)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> racional(nx <span class="op">*</span> dy <span class="op">+</span> ny <span class="op">*</span> dx, dx <span class="op">*</span> dy)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mult(x, y):</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> racional(numer(x) <span class="op">*</span> numer(y), denom(x) <span class="op">*</span> denom(y))</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> iguales(x, y):</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> numer(x) <span class="op">*</span> denom(y) <span class="op">==</span> numer(y) <span class="op">*</span> denom(x)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> imprimir(x):</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(numer(x), <span class="st">&#39;/&#39;</span>, denom(x), sep<span class="op">=</span><span class="st">&#39;&#39;</span>)</span></code></pre></div></li>
<li><p>Esta implementación es correcta porque se ha obtenido a partir de
la especificación de los racionales, y en cuanto se tengan implementadas
las funciones <code>racional</code>, <code>numer</code> y
<code>denom</code>, funcionará perfectamente.</p></li>
</ul>
</section>
<section class="slide level5" data-number="3.1.0.0.1">

<ul>
<li><p>Ahora tenemos las operaciones sobre números racionales
implementadas sobre las funciones selectoras <code>numer</code> y
<code>denom</code> y la función constructora <code>racional</code>, pero
aún no hemos implementado estas tres funciones.</p></li>
<li><p>Lo que necesitamos es alguna forma de unir un numerador y un
denominador en un único valor compuesto (una pareja de
números).</p></li>
<li><p>Podemos usar cualquier representación que nos permita combinar
ambos valores (numerador y denominador) en una sola unidad y que también
nos permita manipular cada valor por separado cuando sea
necesario.</p></li>
</ul>
</section>
<section class="slide level5" data-number="3.1.0.0.2">

<ul>
<li><p>Por ejemplo, podemos usar una lista de dos números enteros para
representar un racional mediante su numerador y su denominador:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> racional(n, d):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;&quot;&quot;Un racional es una lista que contiene el numerador y el denominador.&quot;&quot;&quot;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [n, d]</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> numer(x):</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;&quot;&quot;El numerador es el primer elemento de la lista.&quot;&quot;&quot;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x[<span class="dv">0</span>]</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> denom(x):</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;&quot;&quot;El denominador es el segundo elemento de la lista.&quot;&quot;&quot;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x[<span class="dv">1</span>]</span></code></pre></div></li>
<li><p>Junto con las operaciones aritméticas que definimos
anteriormente, podemos manipular números racionales con las funciones
que hemos definido y sin tener que conocer su representación
interna:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> medio <span class="op">=</span> racional(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> imprimir(medio)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">/</span><span class="dv">2</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> tercio <span class="op">=</span> racional(<span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> imprimir(mult(medio, tercio))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">/</span><span class="dv">6</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> imprimir(suma(tercio, tercio))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span><span class="op">/</span><span class="dv">9</span></span></code></pre></div></li>
</ul>
</section>
<section class="slide level5" data-number="3.1.0.0.3">

<ul>
<li><p>Como muestra el ejemplo anterior, nuestra implementación de
números racionales no simplifica las fracciones resultantes.</p></li>
<li><p>Podemos corregir ese defecto simplemente cambiando la
implementación de <code>racional</code>.</p></li>
<li><p>Usando el máximo común divisor podemos reducir el numerador y el
denominador para obtener el número racional simplificado:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> gcd</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> racional(n, d):</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> gcd(n, d)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [n <span class="op">//</span> g, d <span class="op">//</span> g]</span></code></pre></div></li>
<li><p>Con esta implementación revisada de <code>racional</code> nos
aseguramos de que los racionales se expresan de la forma más
simplificada posible:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> imprimir(suma(tercio, tercio))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="op">/</span><span class="dv">3</span></span></code></pre></div></li>
</ul>
</section>
<section class="slide level5" data-number="3.1.0.0.4">

<ul>
<li><p>Lo interesante es que este cambio sólo ha afectado al constructor
<code>racional</code>, y las demás operaciones no se han visto afectadas
por ese cambio.</p></li>
<li><p>Esto es así porque el resto de las operaciones no conocen ni
necesitan conocer la representación interna de un número racional (es
decir, la implementación del constructor <code>racional</code>). Sólo
necesitan conocer la <strong>especificación</strong> de
<code>racional</code>, la cual no ha cambiado.</p></li>
</ul>
</section>
<section class="slide level5" data-number="3.1.0.0.5">

<ul>
<li><p>Otra posible implementación sería simplificar el racional no
cuando se <em>construya</em>, sino cuando se <em>acceda</em> a alguna de
sus partes:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> racional(n, d):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [n, d]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> numer(x):</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> gcd(x[<span class="dv">0</span>], x[<span class="dv">1</span>])</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x[<span class="dv">0</span>] <span class="op">//</span> g</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> denom(x):</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> gcd(x[<span class="dv">0</span>], x[<span class="dv">1</span>])</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x[<span class="dv">1</span>] <span class="op">//</span> g</span></code></pre></div></li>
<li><p>La diferencia entre esta implementación y la anterior está en
cuándo se calcula el máximo común divisor.</p>
<ul>
<li><p>Si los programas que normalmente usan los números racionales
acceden muchas veces a sus numeradores y denominadores, será preferible
calcular el m.c.d. en el constructor.</p></li>
<li><p>En caso contrario, puede que sea mejor esperar a acceder al
numerador o al denominador para calcular el m.c.d.</p></li>
<li><p>En cualquier caso, cuando se cambia una representación por otra,
las demás funciones (<code>suma</code>, <code>mult</code>, etc.) no
necesitan ser modificadas.</p></li>
</ul></li>
</ul>
</section>
<section class="slide level5" data-number="3.1.0.0.6">

<ul>
<li><p>Hacer que la representación dependa sólo de unas cuantas
funciones nos ayuda a diseñar programas, así como a modificarlos, porque
nos permite cambiar la implementación con facilidad cuando sea
necesario.</p></li>
<li><p>Por ejemplo: si estamos diseñando un módulo de números racionales
y aún no hemos decidido si calcular el m.c.d. en el constructor o en los
selectores, la metodología de la abstracción de datos nos permite
retrasar esa decisión y al mismo tiempo seguir programando el resto del
programa.</p></li>
<li><p>Además, si hoy decidimos calcular el m.c.d. en el constructor
pero el día de mañana cambiamos de opinión, podemos calcularlo en los
selectores sin que el resto del programa se vea afectado. Sólo habría
que cambiar la implementación del tipo abstracto.</p></li>
</ul>
</section>
</section>
<section>
<section id="niveles-y-barreras-de-abstracción"
class="title-slide slide level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Niveles
y barreras de abstracción</h1>

</section>
<section id="niveles-de-abstracción" class="title-slide slide level2"
data-number="4.1">
<h2 data-number="4.1"><span class="header-section-number">4.1</span>
Niveles de abstracción</h2>
<ul>
<li><p>Parémonos ahora a considerar algunos de las cuestiones planteadas
en el ejemplo de los números racionales.</p></li>
<li><p>Hemos definido todas las operaciones de <em>rac</em> en términos
de un constructor <code>racional</code> y dos selectores
<code>numer</code> y <code>denom</code>.</p>
<p>En general, la idea que hay detrás de la <strong>abstracción de
datos</strong> es la de:</p>
<ol>
<li><p>definir un <strong>nuevo tipo de datos</strong>
(abstracto),</p></li>
<li><p>identificar un <strong>conjunto básico de operaciones</strong>
sobre las cuales se expresarán todas las operaciones que manipulen los
valores de ese tipo, y luego</p></li>
<li><p><strong>obligar a usar sólo esas operaciones</strong> para
manipular los datos.</p></li>
</ol></li>
<li><p>Al obligar a usar los datos únicamente a través de sus
operaciones, es mucho más fácil cambiar luego la representación interna
de los datos abstractos o la implementación de las operaciones básicas
sin tener que cambiar el resto del programa.</p></li>
</ul>
</section>
<section class="slide level5" data-number="4.1.0.0.1">

<ul>
<li>Para el caso de los números racionales, diferentes partes del
programa manipulan números racionales usando diferentes operaciones,
como se describe en esta tabla:</li>
</ul>
<p><br></p>
<table style="width:99%;">
<colgroup>
<col style="width: 33%" />
<col style="width: 34%" />
<col style="width: 31%" />
</colgroup>
<thead>
<tr>
<th>Las partes del programa que…</th>
<th>Tratan a los racionales como…</th>
<th>Usando sólo…</th>
</tr>
</thead>
<tbody>
<tr>
<td>Usan números racionales para realizar cálculos</td>
<td>Valores de datos completos, un todo</td>
<td><code>suma</code>, <code>mult</code>, <code>iguales</code>,
<code>imprimir</code></td>
</tr>
<tr>
<td>Crean racionales o implementan operaciones sobre racionales</td>
<td>Numeradores y denominadores</td>
<td><code>racional</code>, <code>numer</code>, <code>denom</code></td>
</tr>
<tr>
<td>Implementan selectores y constructores de racionales</td>
<td>Parejas de números representadas como listas de dos elementos</td>
<td>Literales de tipo lista <code>[</code>_<code>]</code> e indexación
_<code>[</code>_<code>]</code></td>
</tr>
</tbody>
</table>
</section>

<section id="barreras-de-abstracción" class="title-slide slide level2"
data-number="4.2">
<h2 data-number="4.2"><span class="header-section-number">4.2</span>
Barreras de abstracción</h2>
<ul>
<li><p>Cada una de las filas de la tabla anterior representa un nivel de
abstracción, de forma que cada nivel usa las operaciones y las
facilidades ofrecidas por el nivel inmediatamente inferior.</p></li>
<li><p>Dicho de otra forma: en cada nivel, las funciones que aparecen en
la última columna imponen una <strong>barrera de abstracción</strong>.
Estas funciones son usadas desde un nivel más alto de abstracción e
implementadas usando un nivel más bajo de abstracción.</p></li>
</ul>
</section>
<section class="slide level5" data-number="4.2.0.0.1">

<div class="centered">
<figure>
<img data-src="images/barreras-abstraccion.svg" class="plain"
style="width:75.0%" alt="Barreras de abstracción" />
<figcaption aria-hidden="true">Barreras de abstracción</figcaption>
</figure>
</div>
</section>
<section class="slide level5" data-number="4.2.0.0.2">

<ul>
<li><p>Se produce una <strong><em>violación</em> de una barrera de
abstracción</strong> cada vez que una parte del programa que puede
utilizar una función de un determinado nivel, utiliza una función de un
nivel más bajo.</p></li>
<li><p>Por ejemplo, una función que calcula el cuadrado de un número
racional se implementa mejor en términos de <code>mult</code>, que no
necesita suponer nada sobre cómo se implementa un número racional:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cuadrado(x):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mult(x,x)</span></code></pre></div></li>
</ul>
</section>
<section class="slide level5" data-number="4.2.0.0.3">

<ul>
<li><p>Si hiciéramos referencia directa a los numeradores y los
denominadores, estaríamos violando una barrera de abstracción:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cuadrado_viola_una_barrera(x):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> racional(numer(x) <span class="op">*</span> numer(x), denom(x) <span class="op">*</span> denom(x))</span></code></pre></div></li>
<li><p>Y si usamos el conocimiento de que los racionales se representan
como listas, estaríamos violando dos barreras de abstracción:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cuadrado_viola_dos_barreras(x):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [x[<span class="dv">0</span>] <span class="op">*</span> x[<span class="dv">0</span>], x[<span class="dv">1</span>] <span class="op">*</span> x[<span class="dv">1</span>]]</span></code></pre></div></li>
</ul>
<div class="caja">
<p>Cuantas menos barreras de abstracción se crucen al escribir
programas, mejor.</p>
</div>
</section>
<section class="slide level5" data-number="4.2.0.0.4">

<ul>
<li><p>Las barreras de abstracción hacen que los programas sean más
fáciles de mantener y modificar.</p></li>
<li><p>Cuantas menos funciones dependan de una representación
particular, menos cambios se necesitarán cuando se quiera cambiar esa
representación.</p></li>
<li><p>Todas las implementaciones de <code>cuadrado</code> que acabamos
de ver se comportan correctamente, pero sólo la primera es lo bastante
robusta como para soportar bien los futuros cambios de los niveles
inferiores.</p></li>
<li><p>La función <code>cuadrado</code> no tendrá que cambiarse incluso
aunque cambiemos la representación interna de los números
racionales.</p></li>
<li><p>Por el contrario, <code>cuadrado_viola_una_barrera</code> tendrá
que cambiarse cada vez que cambien las especificaciones del constructor
o los selectores, y <code>cuadrado_viola_dos_barreras</code> tendrá que
cambiarse cada vez que cambie la representación interna de los números
racionales.</p></li>
</ul>
</section>

<section id="propiedades-de-los-datos" class="title-slide slide level2"
data-number="4.3">
<h2 data-number="4.3"><span class="header-section-number">4.3</span>
Propiedades de los datos</h2>
<ul>
<li><p>Las barreras de abstracción definen de qué forma pensamos sobre
los datos.</p></li>
<li><p>Por ejemplo, podemos pensar que las operaciones
<code>suma</code>, <code>mult</code>, etc. están definidas sobre
<em>datos</em> (numeradores, denominadores y racionales) cuyo
comportamiento está definido por las funciones <code>racional</code>,
<code>numer</code> y <code>denom</code>.</p></li>
<li><p>Pero… ¿qué es un <em>dato</em>? No basta con decir que es
«cualquier cosa implementada mediante ciertos constructores y
selectores».</p></li>
<li><p>Siguiendo con el mismo ejemplo: es evidente que cualquier grupo
de tres funciones (un constructor y dos selectores) no sirve para
representar adecuadamente a los números racionales.</p>
<p>Además, se tiene que garantizar que, entre el constructor
<code>racional</code> y los selectores <code>numer</code> y
<code>denum</code>, se cumple la siguiente propiedad:</p>
<div class="caja">
<p>Si <span class="math inline">x</span> <code>=</code>
<code>racional(</code><span class="math inline">n</span><code>,</code> 
<span class="math inline">d</span><code>)</code>, entonces
<code>numer(</code><span
class="math inline">x</span><code>)/denom(</code><span
class="math inline">x</span><code>)</code> <code>==</code> <span
class="math inline">n/d</span> .</p>
</div></li>
</ul>
</section>
<section class="slide level5" data-number="4.3.0.0.1">

<ul>
<li><p>De hecho, esta es la única condición que deben cumplir las tres
funciones para poder representar adecuadamente a los números
racionales.</p></li>
<li><p>Una representación válida de un número racional no está limitada
a ninguna implementación particular (como, por ejemplo, una lista de dos
elementos), sino que nos sirve cualquier implementación que satisfaga la
propiedad anterior.</p></li>
<li><p>En general, podemos decir que <strong>los tipos de datos
abstractos se definen mediante una colección de constructores y
selectores junto con algunas <em>propiedades</em> que los datos
abstractos deben cumplir</strong>.</p></li>
<li><p>Mientras se cumplan dichas propiedades (como la anterior de la
división), los constructores y selectores constituyen una representación
válida de un tipo de datos abstracto.</p></li>
</ul>
</section>
<section class="slide level5" data-number="4.3.0.0.2">

<ul>
<li><p><strong>Los detalles de implementación</strong> debajo de una
barrera de abstracción <strong>pueden cambiar</strong>, pero si no
cambia su comportamiento observable desde un lugar situado por encima de
la barrera, entonces la abstracción de datos sigue siendo válida y
cualquier programa escrito utilizando esta abstracción de datos seguirá
siendo correcto.</p></li>
<li><p>Este punto de vista tambíen se puede aplicar, por ejemplo, a las
listas que hemos usado para implementar números racionales.</p></li>
<li><p>En realidad, tampoco hace falta que sea una lista. Nos basta con
cualquier representación que agrupe una pareja de valores juntos y que
nos permita acceder a cada valor de una pareja por separado. Es decir,
la propiedad que tienen que cumplir las parejas es que:</p>
<div class="caja">
<p>Si <span class="math inline">p</span> <code>=</code>
<code>pareja(</code><span class="math inline">x</span><code>,</code> 
<span class="math inline">y</span><code>)</code>, entonces
<code>select(</code><span class="math inline">p</span><code>, 0)</code>
<code>==</code> <span class="math inline">x</span><br />
y <code>select(</code><span
class="math inline">p</span><code>, 1)</code> <code>==</code> <span
class="math inline">y</span>.</p>
</div></li>
<li><p>Tales propiedades se describen como <strong>ecuaciones</strong>
en la <strong>especificación algebraica</strong> del tipo
abstracto.</p></li>
</ul>
</section>
</section>
<section>
<section id="las-funciones-como-datos" class="title-slide slide level1"
data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Las
funciones como datos</h1>

</section>
<section id="clausuras" class="title-slide slide level2"
data-number="5.1">
<h2 data-number="5.1"><span class="header-section-number">5.1</span>
Clausuras</h2>
<ul>
<li><p>Anteriormente, hemos dicho que los datos se caracterizan por las
<strong>operaciones</strong> (constructoras y selectoras) con las que se
manipulan y por las <strong>propiedades</strong> que cumplen dichas
operaciones, de manera que <strong>podemos cambiar los detalles de
implementación</strong> bajo una barrera de abstracción siempre que no
cambiemos su comportamiento observable.</p></li>
<li><p>Por tanto, bajo esa barrera de abstracción podemos usar cualquier
implementación siempre y cuando logren que las operaciones que definen
dicha barrera satisfagan las propiedades que deben cumplir.</p></li>
<li><p>Por ejemplo, para representar a los números racionales usamos
parejas de números, pero esas parejas se pueden representar de muchas
maneras. Podemos usar listas, pero en general nos sirve cualquier dato
definido por un constructor <code>pareja</code> y un selector
<code>select</code> que cumpla:</p>
<div class="caja">
<p>Si <span class="math inline">p</span> <code>=</code>
<code>pareja(</code><span class="math inline">x</span><code>,</code> 
<span class="math inline">y</span><code>)</code>, entonces
<code>select(</code><span class="math inline">p</span><code>, 0)</code>
<code>==</code> <span class="math inline">x</span><br />
y <code>select(</code><span
class="math inline">p</span><code>, 1)</code> <code>==</code> <span
class="math inline">y</span>.</p>
</div></li>
</ul>
</section>
<section class="slide level5" data-number="5.1.0.0.1">

<ul>
<li><p>Esas dos operaciones, <code>pareja</code> y <code>select</code>,
que deben cumplir la condición antes indicada, formarían otra barrera de
abstracción sobre la cual se podrían implementar los números
racionales:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> racional(x, y):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pareja(x, y)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> numer(r):</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> select(r, <span class="dv">0</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> denom(r):</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> select(r, <span class="dv">1</span>)</span></code></pre></div></li>
<li><p>Igualmente, para implementar las parejas, nos valdría cualquier
implementación que satisfaga la propiedad que deben cumplir las
parejas.</p></li>
<li><p>Por ejemplo, cualquier estructura de datos o tipo compuesto que
permita almacenar dos elementos juntos y seleccionar cada elemento por
separado, como una lista, una tupla o algo similar:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pareja(x, y):</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [x, y]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> select(p, i):</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> p[i]</span></code></pre></div></li>
</ul>
</section>
<section class="slide level5" data-number="5.1.0.0.2">

<ul>
<li><p>Pero, de hecho, ni siquiera necesitamos estructuras de datos para
representar parejas de números.</p></li>
<li><p>Podemos implementar dos funciones <code>pareja</code> y
<code>select</code> que cumplan con la propiedad anterior tan bien como
una lista de dos elementos:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pareja(x, y):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;&quot;&quot;Devuelve una función que representa una pareja.&quot;&quot;&quot;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get(indice):</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> indice <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> x</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> indice <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> y</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> get</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> select(p, i):</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;&quot;&quot;Devuelve el elemento situado en el índice i de la pareja p.&quot;&quot;&quot;</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> p(i)</span></code></pre></div></li>
<li><p>Con esta implementación, podemos crear y manipular parejas:</p>
<div class="columns">
<div class="column" style="width:40%;">
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> p <span class="op">=</span> pareja(<span class="dv">20</span>, <span class="dv">14</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> select(p, <span class="dv">0</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="dv">20</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> select(p, <span class="dv">1</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span></span></code></pre></div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:40%;">
<div class="centered">
<p><a
href="http://pythontutor.com/visualize.html#code=def%20pareja%28x,%20y%29%3A%0A%20%20%20%20%22%22%22Devuelve%20una%20funci%C3%B3n%20que%20representa%20una%20pareja.%22%22%22%0A%20%20%20%20def%20get%28indice%29%3A%0A%20%20%20%20%20%20%20%20if%20indice%20%3D%3D%200%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20x%0A%20%20%20%20%20%20%20%20elif%20indice%20%3D%3D%201%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20y%0A%20%20%20%20return%20get%0A%0Adef%20select%28p,%20i%29%3A%0A%20%20%20%20%22%22%22Devuelve%20el%20elemento%20situado%20en%20el%20%C3%ADndice%20i%20de%20la%20pareja%20p.%22%22%22%0A%20%20%20%20return%20p%28i%29%0A%0Ap%20%3D%20pareja%2820,%2014%29%0Aq%20%3D%20pareja%285,%206%29%0Aprint%28select%28p,%200%29%29%0Aprint%28select%28q,%200%29%29%0Aprint%28select%28p,%201%29%29%0Aprint%28select%28q,%201%29%29&amp;cumulative=false&amp;heapPrimitives=nevernest&amp;mode=edit&amp;origin=opt-frontend.js&amp;py=3&amp;rawInputLstJSON=%5B%5D&amp;textReferences=false"
target="_blank">Ver en Pythontutor</a></p>
</div>
</div>
</div></li>
</ul>
</section>
<section class="slide level5" data-number="5.1.0.0.3">

<ul>
<li><p>Cuando se llama a la función <code>pareja</code>, ésta devuelve
otra función llamada <code>get</code> (por tanto, <code>pareja</code> es
una función de orden superior).</p></li>
<li><p>Además, <code>get</code> es una función local a la función
<code>pareja</code>, ya que está definida en el ámbito de
<code>pareja</code>.</p></li>
<li><p>Por tanto, el marco de <code>get</code> apunta al de
<code>pareja</code> en el entorno.</p></li>
<li><p>Las variables <code>x</code> e <code>y</code> son los parámetros
de la función <code>pareja</code>, así que son locales a ella y, por
tanto, sus ligaduras y referencias se almacenan en su marco.</p></li>
<li><p>Pero la función <code>get</code> necesita acceder al valor de
esas variables.</p></li>
<li><p>Esas variables están en el entorno de <code>get</code>, ya que el
marco de <code>get</code> apunta al de <code>pareja</code> en el
entorno.</p></li>
<li><p>En consecuencia, la función <code>get</code> puede acceder a
<code>x</code> e <code>y</code>.</p></li>
</ul>
</section>
<section class="slide level5" data-number="5.1.0.0.4">

<div class="centered">
<figure>
<img data-src="images/entorno-pareja-get.svg" class="plain"
style="width:80.0%"
alt="Entorno dentro de la función get al llamar a select(p, 0)" />
<figcaption aria-hidden="true">Entorno dentro de la función
<code>get</code> al llamar a <code>select(p, 0)</code></figcaption>
</figure>
</div>
<ul>
<li><p>El problema es que, cuando se va a ejecutar <code>get</code> a
través de la llamada a <code
class="sourceCode python">select(p, <span class="dv">0</span>)</code>,
el marco de <code>pareja</code> no estaría en la pila, ya que no hay
ninguna llamada activa a la función <code>pareja</code>.</p></li>
<li><p>Y para que <code>get</code> pueda seguir accediendo a las
variables <code>x</code> e <code>y</code> (que son locales a
<code>pareja</code>), es necesario que el marco de <code>pareja</code>
no se elimine de la memoria cuando finalice la ejecución de
<code>pareja</code>.</p></li>
<li><p>Necesitamos un nuevo mecanismo que permita resolver este
problema.</p></li>
</ul>
</section>
<section class="slide level5" data-number="5.1.0.0.5">

<ul>
<li><p>El <strong>entorno de definición</strong> (o
<strong><em>contexto</em></strong>) de una función está formado por
<strong>los marcos que hay en el entorno cuando se define la
función</strong>.</p></li>
<li><p>Por ejemplo, el entorno de definición de <code>get</code>
contiene, en este orden, el marco de <code>pareja</code> (ya que
<code>get</code> es local a <code>pareja</code>) y el marco global.</p>
<p>Por tanto, el entorno de definición de una función NO contiene el
marco de la propia función.</p></li>
<li><p>El entorno de definición de una función representa el contexto en
el que se definió la función.</p>
<p>Es posible que la función necesite información almacenada en ese
contexto para que pueda funcionar correctamente.</p></li>
<li><p>La combinación de una función más su entorno de definición se
denomina <strong>clausura</strong>.</p>
<div class="caja centered">
<p>Clausura = función + entorno de definición</p>
</div></li>
<li><p>Una clausura, por tanto, agrupa una función con la información
que puede que la función necesite para poder funcionar.</p></li>
</ul>
</section>
<section class="slide level5" data-number="5.1.0.0.6">

<ul>
<li><p>Después de hacer:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> pareja(<span class="dv">20</span>, <span class="dv">14</span>)</span></code></pre></div>
<p>tenemos que <code>p</code> contiene una clausura.</p></li>
<li><p>Esa clausura esta formada por:</p>
<ul>
<li><p>La <strong>función</strong> que hay en <code>p</code>, que es la
función <code>get</code>.</p></li>
<li><p>El <strong>entorno de definición</strong> de <code>p</code>, que
contiene dos marcos:</p>
<ul>
<li><p>El marco de <code>pareja</code> (ya que la función
<code>get</code> es local a <code>pareja</code>), el cual recuerda los
valores que tenían las variables locales de <code>pareja</code> cuando
se creó la clausura.</p></li>
<li><p>El marco global.</p></li>
</ul></li>
</ul></li>
<li><p>El marco global sigue en la pila, pero el marco de
<code>pareja</code> no, ya que esa función no tiene ninguna llamada
activa en este momento.</p></li>
<li><p>El problema es que la clausura <code>p</code> necesita ese marco
para poder acceder a las variables que contiene.</p></li>
</ul>
</section>
<section class="slide level5" data-number="5.1.0.0.7">

<ul>
<li><p>Para no perder el marco de la función <code>pareja</code> cuando
termina de ejecutarse ésta, el intérprete saca su marco de la pila pero
no lo destruye, sino que <strong>lo guarda en el montículo</strong> como
si fuera un dato más.</p></li>
<li><p>Ahora la clausura hace referencia al marco dentro del montículo,
es decir, que la clausura guarda una referencia al marco, que ahora es
un dato más dentro del montículo.</p></li>
<li><p>Ese marco seguirá existiendo en el montículo mientras haya una
referencia que apunte a él, como cualquier otro dato.</p></li>
<li><p>Además, ese marco seguirá apuntando al marco global (que sigue
almacenado en la pila) que también forma parte del entorno.</p></li>
<li><p>En resumen: el intérprete guardará en el montículo aquellos
marcos que sean necesarios para el funcionamiento de alguna clausura, y
los enlazará con otros marcos formando entornos de definición.</p></li>
</ul>
</section>
<section class="slide level5" data-number="5.1.0.0.8">

<ul>
<li>Las clausuras las representaremos gráficamente como una función de
la que sale una flecha que va hasta el primer marco de su entorno de
definición, que es el marco del ámbito donde se definió esa
función.</li>
</ul>
<div class="centered">
<figure>
<img data-src="images/pila-pareja-get.svg" class="plain"
style="width:70.0%"
alt="Pila de control después de hacer p = pareja(20, 14)" />
<figcaption aria-hidden="true">Pila de control después de hacer
<code>p = pareja(20, 14)</code></figcaption>
</figure>
</div>
<p><br></p>
<ul>
<li>El <span style="color:red">círculo rojo</span> representa la función
de la clausura, y la <span style="color:blue">flecha azul</span> apunta
al entorno de definición de la clausura, que aquí está formado por el
marco de <code>pareja</code> y el marco global (en ese orden).</li>
</ul>
</section>
<section class="slide level5" data-number="5.1.0.0.9">

<ul>
<li><p>Por tanto, la clausura almacenada en <code>p</code> contiene la
función y el entorno que contiene la información que probablemente sea
necesaria para poder ejecutar la función.</p></li>
<li><p>Aquí, la clausura apunta al marco de <code>pareja</code>, ya que
es local a <code>pareja</code> y necesita acceder a los datos definidos
en el ámbito de <code>pareja</code>.</p></li>
<li><p>Cuando se llame a la función de la clausura <code>p</code>, se
creará su marco en la pila, el cual apuntará al entorno de definición de
<code>p</code>.</p></li>
<li><p>Por tanto, durante la ejecución de <code>p</code>, el entorno
estaría formado por el marco de <code>p</code> (almacenado en la pila),
seguido del marco de <code>pareja</code> (almacenado en el montículo),
seguido del marco global (almacenado en la pila).</p></li>
<li><p>Naturalmente, el marco de <code>p</code> permanecerá en la pila
mientras esté activa la llamada a <code>p</code>.</p></li>
</ul>
</section>
<section class="slide level5" data-number="5.1.0.0.10">

<ul>
<li><p>Por ejemplo, si hacemos:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> pareja(<span class="dv">20</span>, <span class="dv">14</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> p(<span class="dv">0</span>)</span></code></pre></div>
<p>durante la ejecución de <code
class="sourceCode python">p(<span class="dv">0</span>)</code> tendremos
lo siguiente:</p></li>
</ul>
<div class="centered">
<figure>
<img data-src="images/clausura-p0.svg" class="plain" style="width:70.0%"
alt="Estado del programa durante la ejecución de x = p(0)" />
<figcaption aria-hidden="true">Estado del programa durante la ejecución
de <code>x = p(0)</code></figcaption>
</figure>
</div>
</section>
<section class="slide level5" data-number="5.1.0.0.11">

<ul>
<li><p>Si tenemos dos clausuras <code>p</code> y <code>q</code> creadas
de la siguiente manera:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> pareja(<span class="dv">20</span>, <span class="dv">14</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> pareja(<span class="dv">5</span>, <span class="dv">6</span>)</span></code></pre></div>
<p>en memoria tendremos lo siguiente:</p></li>
</ul>
<div class="centered">
<figure>
<img data-src="images/clausuras-p-q.svg" class="plain"
style="width:70.0%" alt="Estado del programa tras crear p y q" />
<figcaption aria-hidden="true">Estado del programa tras crear
<code>p</code> y <code>q</code></figcaption>
</figure>
</div>
</section>
<section class="slide level5" data-number="5.1.0.0.12">

<ul>
<li><p>Al llamar a <code>select(p, i)</code> se llama luego a
<code>p(i)</code>, pero como <code>p</code> representa a la función
<code>get</code>, realmente se llama a <code>get(i)</code>.</p></li>
<li><p>Lo mismo pasa al llamar a <code>select(q, i)</code>: se llama a
<code>q(i)</code> pero, como <code>q</code> también representa a
<code>get</code>, realmente se llama a <code>get(i)</code>.</p></li>
<li><p>Lo interesante es que <code>p</code> y <code>q</code> son
referencias a la misma función <code>get</code>, pero cada una de ellas
recuerda el valor que tenían las variables <em>no locales</em> (la
<code>x</code> y la <code>y</code> de <code>pareja</code>) cuando se
crearon <code>p</code> y <code>q</code>.</p></li>
<li><p>Es decir: <code>p</code> y <code>q</code> son funciones que
recuerdan el contexto en el que fueron creadas.</p></li>
<li><p>Por tanto:</p>
<ul>
<li><p><code>p</code> es la función <code>get</code> pero, para ella,
<code>x</code> vale <code
class="sourceCode python"><span class="dv">20</span></code> e
<code>y</code> vale <code
class="sourceCode python"><span class="dv">14</span></code>.</p></li>
<li><p><code>q</code> es la función <code>get</code> pero, para ella,
<code>x</code> vale <code
class="sourceCode python"><span class="dv">5</span></code> e
<code>y</code> vale <code
class="sourceCode python"><span class="dv">6</span></code>.</p></li>
</ul></li>
<li><p>Así que <code>p</code> y <code>q</code> no son exactamente la
misma cosa.</p></li>
</ul>
</section>
<section class="slide level5" data-number="5.1.0.0.13">

<ul>
<li><p>El funcionamiento de las clausuras está muy relacionado con el de
los módulos.</p></li>
<li><p>Si la clausura se define en un módulo y éste se importa en otro
módulo, entonces el entorno de definición de la clausura acabará en el
marco global del módulo donde se ha definido la clausura y no contendrá
el marco global del módulo importador.</p></li>
<li><p>Recordemos que el ámbito del <em>script</em> donde se almacena un
módulo constituye el ámbito global de ese módulo, y que, al importar un
módulo, su marco global debe permanecer en la memoria para que los
miembros del módulo puedan acceder a otros elementos del mismo.</p></li>
</ul>
</section>
<section class="slide level5" data-number="5.1.0.0.14">

<ul>
<li><p>Cuando el módulo se importa usando <code
class="sourceCode python"><span class="im">import</span> módulo</code>:</p>
<ol>
<li><p>Se mete su marco en la pila.</p></li>
<li><p>Se ejecutan sus sentencias, y sus definiciones crean ligaduras y
variables que se almacenan en ese marco.</p></li>
<li><p>Cuando se acaba, se saca el módulo de la pila y se convierte en
un objeto en el montículo que representa al módulo.</p></li>
</ol></li>
<li><p>Las funciones definidas dentro de ese módulo, en realidad son
clausuras que recuerdan el contexto en el que se definieron, hasta el
marco global del módulo donde se han definido.</p></li>
<li><p>Es decir: los entornos de definición de esas clausuras acaban en
el marco de ese módulo.</p></li>
<li><p>El marco del módulo importador NO está dentro del entorno de esas
funciones.</p></li>
</ul>
</section>
<section class="slide level5" data-number="5.1.0.0.15">

<ul>
<li><p>Por ejemplo:</p>
<div class="columns">
<div class="column" style="width:45%;">
<div class="sourceCode" id="cb23"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># uno.py:</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f():</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span></code></pre></div>
</div><div class="column" style="width:5%;">

</div><div class="column" style="width:45%;">
<div class="sourceCode" id="cb24"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dos.py:</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> uno</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(uno.f()) <span class="co"># imprime 1</span></span></code></pre></div>
</div>
</div></li>
<li><p>Al hacer <code
class="sourceCode python"><span class="im">import</span> uno</code>:</p>
<ol>
<li>Se crea un marco para <code>uno</code> en la pila.</li>
<li>Se ejecutan sus sentencias, que almacenan las ligaduras y variables
de <code>x</code> y <code>f</code> en ese marco.</li>
<li>Cuando se termina de ejecutar el módulo, se saca su marco de la pila
y se almacena como un objeto en el montículo.</li>
<li>Se crea en el marco de <code>dos</code> una ligadura que hace
referencia a ese objeto.</li>
</ol></li>
<li><p>Al llamar a <code>uno.f()</code>, el entorno de <code>f</code>
está formado por su propio marco y por el marco global de
<code>uno</code>, por lo que <code>f</code> tiene toda la información
que necesita para funcionar.</p></li>
</ul>
</section>
<section class="slide level5" data-number="5.1.0.0.16">

<ul>
<li><p>El entorno de <code>f</code> NO contiene el marco global de
<code>dos</code>.</p></li>
<li><p>Por ejemplo:</p>
<div class="columns">
<div class="column" style="width:35%;">
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># uno.py:</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f():</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span></code></pre></div>
</div><div class="column" style="width:5%;">

</div><div class="column" style="width:55%;">
<div class="sourceCode" id="cb26"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dos.py:</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> uno</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">35</span>         <span class="co"># crea una nueva x en dos</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(uno.f()) <span class="co"># sigue imprimiendo 1</span></span></code></pre></div>
</div>
</div></li>
<li><p>Aquí, al llamar a <code>uno.f()</code> se observa que sigue
devolviendo <code>1</code> y no <code>35</code>, ya que <code>f</code>
sigue recordando que <code>x</code> vale <code>1</code>.</p></li>
<li><p>Recordemos que el entorno de <code>f</code> está formado por su
marco y por el marco global de <code>uno</code>.</p></li>
</ul>
</section>
<section class="slide level5" data-number="5.1.0.0.17">

<ul>
<li><p>Y en este caso:</p>
<div class="columns">
<div class="column" style="width:35%;">
<div class="sourceCode" id="cb27"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># uno.py:</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f():</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span></code></pre></div>
</div><div class="column" style="width:5%;">

</div><div class="column" style="width:55%;">
<div class="sourceCode" id="cb28"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dos.py:</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> uno</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">35</span>         <span class="co"># crea una nueva x en uno</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(uno.f()) <span class="co"># da error</span></span></code></pre></div>
</div>
</div></li>
<li><p>Aquí, al llamar a <code>uno.f()</code> da un error porque el
entorno de <code>f</code> no contiene ninguna <code>x</code>, ya que ese
entorno está formado por su marco y por el marco global de
<code>uno</code> (NO contiene al marco global de
<code>dos</code>).</p></li>
</ul>
</section>
<section class="slide level5" data-number="5.1.0.0.18">

<ul>
<li><p>Si usamos <code
class="sourceCode python"><span class="im">from</span> ... <span class="im">import</span> ...</code>:</p>
<div class="columns">
<div class="column" style="width:45%;">
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># uno.py:</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f():</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span></code></pre></div>
</div><div class="column" style="width:5%;">

</div><div class="column" style="width:45%;">
<div class="sourceCode" id="cb30"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dos.py:</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> uno <span class="im">import</span> f</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(f()) <span class="co"># imprime 1</span></span></code></pre></div>
</div>
</div></li>
<li><p>Al hacer <code
class="sourceCode python"><span class="im">from</span> uno <span class="im">import</span> f</code>,
estamos importando sólo la función <code>f</code>, no el módulo
<code>uno</code> como tal, pero al hacerlo ya estaríamos perdiendo el
marco global del módulo <code>uno</code>, que contiene información que
necesita la función <code>f</code> (en este caso, la variable
<code>x</code>).</p></li>
<li><p>Por tanto, aquí <code>f</code> es una clausura porque necesita
acceder a una variable (<code>x</code>) que está fuera del ámbito cuando
se llama a <code>f</code> desde el módulo <code>dos</code>.</p></li>
<li><p>Para que la llamada a <code>f()</code> funcione correctamente en
<code>dos</code>, el intérprete debe conservar el marco del módulo
<code>uno</code> y enlazarlo con <code>f</code>.</p></li>
</ul>
</section>
<section class="slide level5" data-number="5.1.0.0.19">

<ul>
<li><p>En detalle, cuando el intérprete ejecuta <code
class="sourceCode python"><span class="im">from</span> uno <span class="im">import</span> f</code>:</p>
<ol>
<li><p>Crea el marco de <code>uno</code> en la pila y ejecuta sus
sentencias.</p></li>
<li><p>En el marco de <code>uno</code> se guardan las ligaduras y
variables de <code>x</code> y <code>f</code>.</p></li>
<li><p>Al terminar de ejecutarse el módulo <code>uno</code>, se saca su
marco de la pila pero no se elimina, sino que se almacena en el
montículo, ya que ese marco pertenece al entorno de definición de
<code>f</code>.</p></li>
<li><p>En el marco de <code>dos</code>, se crea la ligadura entre
<code>f</code> y la clausura formada por la función <code>f</code> de
<code>uno</code> y su entorno de definición.</p></li>
</ol></li>
<li><p>El entorno de definición de <code>f</code> está formado
únicamente por el marco del módulo <code>uno</code>.</p></li>
</ul>
</section>
<section class="slide level5" data-number="5.1.0.0.20">

<ul>
<li><p>Si ahora hacemos <code
class="sourceCode python">x <span class="op">=</span> <span class="dv">99</span></code>
en el módulo <code>dos</code>:</p>
<div class="columns">
<div class="column" style="width:44%;">
<div class="sourceCode" id="cb31"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># uno.py:</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span>   <span class="co"># variable global de uno</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f():</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span></code></pre></div>
</div><div class="column" style="width:4%;">

</div><div class="column" style="width:52%;">
<div class="sourceCode" id="cb32"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dos.py:</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> uno <span class="im">import</span> f</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">99</span>      <span class="co"># crea una nueva x en dos</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(f())  <span class="co"># sigue imprimiendo 1</span></span></code></pre></div>
</div>
</div></li>
<li><p>El resultado sigue siendo el mismo que antes, porque:</p>
<ul>
<li><p>La asignación <code
class="sourceCode python">x <span class="op">=</span> <span class="dv">99</span></code>
que se ejecuta dentro del módulo <code>dos</code> crea una nueva
variable <code>x</code> en el marco de <code>dos</code>, y no modifica
la <code>x</code> de <code>uno</code>.</p></li>
<li><p><code>f</code> en <code>dos</code> es una clausura que recuerda
que <code>x</code> valía <code>1</code> cuando se definió al ejecutarse
la sentencia <code
class="sourceCode python"><span class="im">from</span> uno <span class="im">import</span> f</code>.</p></li>
<li><p>Cuando se ejecuta <code>f</code>, su entorno está formado por su
marco y el marco global de <code>uno</code>, en ese orden.</p></li>
<li><p>Por tanto, <code>f</code> accede a la <code>x</code> de
<code>uno</code>, no la de <code>dos</code>.</p></li>
</ul></li>
</ul>
</section>
<section class="slide level5" data-number="5.1.0.0.21">

<ul>
<li><p>Es importante también tener en cuenta que el entorno de
<code>f</code> NO incluye el marco global de <code>dos</code>.</p></li>
<li><p>Por tanto, lo siguiente daría error:</p>
<div class="sourceCode" id="cb33"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># uno.py:</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f():</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x   <span class="co"># Una variable que no está en uno</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dos.py:</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> uno <span class="im">import</span> f</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">99</span>         <span class="co"># crea una nueva x en dos</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(f())     <span class="co"># da error porque la x de dos no está en el entorno de f</span></span></code></pre></div></li>
</ul>
</section>
<section class="slide level5" data-number="5.1.0.0.22">

<ul>
<li><p>Otro ejemplo, con funciones locales:</p>
<div class="columns">
<div class="column" style="width:45%;">
<div class="sourceCode" id="cb35"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># uno.py:</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> padre(a):</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> hijo(b):</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">global</span> x</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>        x <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> a <span class="op">+</span> b <span class="op">+</span> x</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> hijo</span></code></pre></div>
</div><div class="column" style="width:4%;">

</div><div class="column" style="width:45%;">
<div class="sourceCode" id="cb36"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> uno <span class="im">import</span> padre</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> f <span class="op">=</span> padre(<span class="dv">2</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> f(<span class="dv">3</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> f(<span class="dv">3</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> f(<span class="dv">4</span>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span></span></code></pre></div>
</div>
</div></li>
<li><p>El entorno de definición de la clausura <code>f</code> lo forma
el marco de <code>padre</code> seguido del marco de <code>uno</code>
(que juega el papel de marco global para los elementos definidos en
<code>uno</code>) y ambos marcos se guardan en el montículo.</p></li>
</ul>
</section>

<section id="representación-funcional" class="title-slide slide level2"
data-number="5.2">
<h2 data-number="5.2"><span class="header-section-number">5.2</span>
Representación funcional</h2>
<ul>
<li><p>Las funciones <code>pareja</code> y <code>select</code>, así
definidas, son <strong>funciones de orden superior</strong>: la primera
porque devuelve una función y la segunda porque recibe una función como
argumento.</p></li>
<li><p>La función <code>get</code> (la función que devuelve
<code>pareja</code> y que recibe <code>select</code>) <strong>representa
una pareja</strong>, es decir, un <strong>dato</strong>.</p></li>
<li><p>A esto se le denomina <strong>representación
funcional</strong>.</p></li>
<li><p>Ese dato abstracto tiene un constructor (<code>pareja</code>) y
un selector (<code>select</code>).</p></li>
<li><p>El uso de funciones de orden superior para representar datos no
se corresponde con nuestra idea intuitiva de lo que deben ser los
datos.</p></li>
<li><p>Sin embargo, <strong>las funciones son perfectamente capaces de
representar datos compuestos</strong>.</p>
<p>En nuestro caso, estas funciones son suficientes para representar
parejas en nuestros programas.</p></li>
</ul>
</section>
<section class="slide level5" data-number="5.2.0.0.1">

<ul>
<li><p>Esto no quiere decir que Python realmente implemente las listas
mediante funciones. En realidad las implementa de otra forma por razones
de eficiencia, pero podría implementarlas con funciones sin ningún
problema.</p></li>
<li><p>La práctica de la abstracción de datos nos permite cambiar
fácilmente unas representaciones por otras, y una de esas
representaciones puede ser mediante funciones.</p></li>
<li><p>La representación funcional, aunque pueda parecer extraña, es una
forma perfectamente adecuada de representar parejas, ya que cumple las
propiedades que deben cumplir las parejas.</p></li>
<li><p>Este ejemplo también demuestra que la capacidad de manipular
funciones como valores (mediante funciones de orden superior)
proporciona la capacidad de manipular datos compuestos.</p></li>
</ul>
</section>

<section id="estado-interno" class="title-slide slide level2"
data-number="5.3">
<h2 data-number="5.3"><span class="header-section-number">5.3</span>
Estado interno</h2>
<ul>
<li><p>Ciertos datos pueden tener un <strong>estado interno</strong>
consistente en información que el dato almacena (o <em>recuerda</em>) y
que puede cambiar durante la ejecución del programa.</p></li>
<li><p>Por ejemplo:</p>
<ul>
<li><p>Una <strong>lista</strong> posee un estado interno que se
corresponde con su <strong>contenido</strong>, es decir, con los
<strong>elementos que contiene</strong> en un momento dado.</p></li>
<li><p>Esos elementos pueden <strong>cambiar</strong> durante la
ejecución del programa: podemos añadir elementos a la lista, eliminar
elementos de la lista o cambiar un elemento de la lista por otro
distinto.</p></li>
<li><p>Cada vez que efectuamos alguna de estas operaciones sobre una
lista estamos cambiando su estado interno.</p></li>
</ul></li>
<li><p>Por tanto, la palabra «estado» implica un proceso evolutivo en el
tiempo, durante el cual ese estado puede ir cambiando.</p></li>
</ul>
</section>
<section class="slide level5" data-number="5.3.0.0.1">

<ul>
<li><p>Al introducir el concepto de «estado interno» en nuestros datos,
estamos introduciendo también la capacidad de cambiar dicho estado, es
decir, que <strong>los datos ahora son mutables</strong>, y la
<em>mutabilidad</em> es un concepto propio de la <strong>programación
imperativa</strong>.</p></li>
<li><p>Esto nos va a <strong>impedir representar un <em>dato abstracto
mutable</em> usando las especificaciones algebraicas</strong> que hemos
usado hasta hoy, ya que, a partir de ahora, el resultado de una
operación puede depender no sólo de lo que dicten las ecuaciones de la
especificación sino también de la historia previa que haya tenido el
dato abstracto (es decir, de su estado interno).</p></li>
<li><p>Y, por supuesto, nos va a <strong>impedir usar el modelo de
sustitución</strong> para razonar sobre nuestros datos, por lo que
tendremos que usar el modelo de <strong>máquina de
estados</strong>.</p></li>
</ul>
</section>
<section class="slide level5" data-number="5.3.0.0.2">

<ul>
<li><p>A cambio, ganaremos dos cosas:</p>
<ul>
<li><p>La posibilidad de modelar <strong>sistemas modulares</strong>,
basados en partes independientes que actúan como elementos
autónomos.</p></li>
<li><p>La posibilidad de modelar de forma fácil y natural el
comportamiento de <strong>sistemas y procesos</strong> que se dan en el
mundo real y que son inherentemente <strong>dinámicos</strong>, es
decir, que cambian con el tiempo y que van pasando por distintos estados
a medida que se opera con ellos.</p></li>
</ul></li>
<li><p>Para ello, aprovecharemos una característica aún no explorada
hasta ahora: <strong>las funciones también pueden tener estado
interno</strong>.</p></li>
</ul>
</section>
<section class="slide level5" data-number="5.3.0.0.3">

<ul>
<li><p>Por ejemplo, definamos una función que simule el proceso de
retirar dinero de una cuenta bancaria.</p></li>
<li><p>Crearemos una función llamada <code>retirar</code>, que tome como
argumento una cantidad a retirar. Si hay suficiente dinero en la cuenta
para permitir la retirada, <code>retirar</code> devolverá el saldo
restante después de la retirada. De lo contrario, <code>retirar</code>
producirá el error <code>'Fondos insuficientes'</code>.</p></li>
<li><p>Por ejemplo, si empezamos con 100 € en la cuenta, nos gustaría
obtener la siguiente secuencia de valores de retorno al ir llamando a
<code>retirar</code>:</p>
<div class="sourceCode" id="cb37"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> retirar(<span class="dv">25</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="dv">75</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> retirar(<span class="dv">25</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="dv">50</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> retirar(<span class="dv">60</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;Fondos insuficientes&#39;</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> retirar(<span class="dv">15</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="dv">35</span></span></code></pre></div></li>
</ul>
</section>
<section class="slide level5" data-number="5.3.0.0.4">

<ul>
<li><p>La expresión <code>retirar(25)</code>, evaluada dos veces,
produce valores diferentes.</p></li>
<li><p>Por lo tanto, la función <code>retirar</code> <strong>no es
pura</strong>.</p></li>
<li><p>Llamar a la función no sólo devuelve un valor, sino que también
tiene el <strong>efecto lateral</strong> de cambiar la función de alguna
manera, de modo que la siguiente llamada con el mismo argumento
devolverá un resultado diferente.</p></li>
<li><p>Este efecto lateral es el resultado de retirar dinero de los
fondos disponibles <strong>provocando un cambio en el estado de una
variable</strong> que almacena dichos fondos y que se encuentra
<strong>fuera del marco actual</strong>.</p></li>
<li><p>A las operaciones modificadoras que no devuelven un valor nuevo
de un determinado tipo abstracto, sino que <strong>modifica directamente
el propio dato</strong>, las llamaremos
<strong>mutadoras</strong>.</p></li>
</ul>
</section>
<section class="slide level5" data-number="5.3.0.0.5">

<ul>
<li><p>Por tanto, a partir de ahora, un tipo abtracto de datos podrá
tener las siguientes operaciones:</p>
<ul>
<li><p><strong>Constructoras</strong>: operaciones que devuelven un
valor de tipo <span class="math inline">T</span>.</p>
<p>A su vez, las constructoras se dividen en:</p>
<ul>
<li><p><strong>Generadoras</strong>: son aquellas operaciones
constructoras que tienen la propiedad de que sólo con ellas es
suficiente para generar cualquier valor del tipo, y excluyendo
cualquiera de ellas hay valores que no pueden ser generados.</p></li>
<li><p><strong>Modificadoras</strong>: son las operaciones constructoras
que no forman parte del conjunto de las generadoras.</p></li>
</ul></li>
<li><p><strong>Selectoras</strong>: operaciones que toman como argumento
uno o más valores de tipo <span class="math inline">T</span> y que no
devuelven un valor de tipo <span class="math inline">T</span>.</p></li>
<li><p><strong>Mutadoras</strong>: operaciones que modifican
directamente el estado interno de un valor de tipo <span
class="math inline">T</span>.</p></li>
</ul></li>
</ul>
</section>
<section class="slide level5" data-number="5.3.0.0.6">

<ul>
<li><p>Para que <code>retirar</code> funcione, debe empezarse con un
saldo inicial.</p></li>
<li><p>La función <code>deposito</code> es una función de orden superior
que recibe como argumento un saldo inicial y devuelve la propia función
<code>retirar</code>, pero de forma que esa función
<strong>recuerda</strong> el saldo inicial.</p>
<div class="sourceCode" id="cb38"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> retirar <span class="op">=</span> deposito(<span class="dv">100</span>)</span></code></pre></div></li>
<li><p>La implementación de <code>deposito</code> requiere un
<strong>acceso no local</strong> al valor de los fondos iniciales y una
<strong>función local</strong> que actualiza y devuelve dicho valor:</p>
<div class="sourceCode" id="cb39"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> deposito(fondos):</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;&quot;&quot;Devuelve una función que reduce los fondos en cada llamada.&quot;&quot;&quot;</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> deposito_local(cantidad):</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">nonlocal</span> fondos</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cantidad <span class="op">&gt;</span> fondos:</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&#39;Fondos insuficientes&#39;</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>        fondos <span class="op">-=</span> cantidad  <span class="co"># Asignación a variable no local</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> fondos</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> deposito_local</span></code></pre></div></li>
</ul>
</section>

<section id="paso-de-mensajes" class="title-slide slide level2"
data-number="5.4">
<h2 data-number="5.4"><span class="header-section-number">5.4</span>
Paso de mensajes</h2>
<ul>
<li><p>Al poder asignar valores a una variable no local, hemos podido
conservar un estado que es interno para una función pero que evoluciona
y cambia con el tiempo a través de llamadas sucesivas a esa
función.</p></li>
<li><p>Supongamos que queremos ampliar la idea anterior definiendo más
operaciones sobre los fondos de la cuenta corriente.</p></li>
<li><p>Por ejemplo, además de poder retirar una cantidad, queremos
también poder ingresar cantidades en la cuenta, así como consultar en
todo momento su saldo actual.</p></li>
<li><p>En ese caso, podemos usar una técnica que consiste en usar una
función que <strong>despacha</strong> las operaciones en función del
<em>mensaje</em> recibido.</p></li>
</ul>
</section>
<section class="slide level5" data-number="5.4.0.0.1">

<div class="sourceCode" id="cb40"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> deposito(fondos):</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> retirar(cantidad):</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">nonlocal</span> fondos</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cantidad <span class="op">&gt;</span> fondos:</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&#39;Fondos insuficientes&#39;</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>        fondos <span class="op">-=</span> cantidad</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> fondos</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ingresar(cantidad):</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">nonlocal</span> fondos</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>        fondos <span class="op">+=</span> cantidad</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> fondos</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> saldo():</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> fondos</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> despacho(mensaje):</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> mensaje <span class="op">==</span> <span class="st">&#39;retirar&#39;</span>:</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> retirar</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> mensaje <span class="op">==</span> <span class="st">&#39;ingresar&#39;</span>:</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> ingresar</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> mensaje <span class="op">==</span> <span class="st">&#39;saldo&#39;</span>:</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> saldo</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&#39;Mensaje incorrecto&#39;</span>)</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> despacho</span></code></pre></div>
</section>
<section class="slide level5" data-number="5.4.0.0.2">

<!--
```python
def retirar(dep, cantidad):
    return dep('retirar')(cantidad)

def ingresar(dep, cantidad):
    return dep('ingresar')(cantidad)

def saldo(dep):
    return dep('saldo')()
```
-->
<ul>
<li><p>Ahora, un depósito se representa internamente como una función
que recibe mensajes y los despacha a la función correspondiente:</p>
<div class="sourceCode" id="cb41"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> dep <span class="op">=</span> deposito(<span class="dv">100</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> dep</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>function deposito.<span class="op">&lt;</span><span class="bu">locals</span><span class="op">&gt;</span>.despacho at <span class="bn">0x7f0de1300e18</span><span class="op">&gt;</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> dep(<span class="st">&#39;retirar&#39;</span>)(<span class="dv">25</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="dv">75</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> dep(<span class="st">&#39;ingresar&#39;</span>)(<span class="dv">200</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="dv">275</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> dep(<span class="st">&#39;saldo&#39;</span>)()</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="dv">275</span></span></code></pre></div></li>
<li><p>También podemos hacer:</p>
<div class="sourceCode" id="cb42"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> dep <span class="op">=</span> deposito(<span class="dv">100</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> retirar <span class="op">=</span> dep(<span class="st">&#39;retirar&#39;</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> ingresar <span class="op">=</span> dep(<span class="st">&#39;ingresar&#39;</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> saldo <span class="op">=</span> dep(<span class="st">&#39;saldo&#39;</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> retirar(<span class="dv">25</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="dv">75</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> ingresar(<span class="dv">200</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="dv">275</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> saldo()</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="dv">275</span></span></code></pre></div></li>
</ul>
</section>
<section class="slide level5" data-number="5.4.0.0.3">

<ul>
<li>Una variante de esta técnica es la de usar un diccionario para
asociar a cada mensaje con cada operación:</li>
</ul>
<div class="sourceCode" id="cb43"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> deposito(fondos):</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> retirar(cantidad):</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">nonlocal</span> fondos</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cantidad <span class="op">&gt;</span> fondos:</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">&#39;Fondos insuficientes&#39;</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>        fondos <span class="op">-=</span> cantidad</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> fondos</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ingresar(cantidad):</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">nonlocal</span> fondos</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>        fondos <span class="op">+=</span> cantidad</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> fondos</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> saldo():</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> fondos</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>    dic <span class="op">=</span> {<span class="st">&#39;retirar&#39;</span>: retirar, <span class="st">&#39;ingresar&#39;</span>: ingresar, <span class="st">&#39;saldo&#39;</span>: saldo}</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> despacho(mensaje):</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> mensaje <span class="kw">in</span> dic:</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> dic[mensaje]</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&#39;Mensaje incorrecto&#39;</span>)</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> despacho</span></code></pre></div>
</section>
<section class="slide level5" data-number="5.4.0.0.4">

<ul>
<li><p>Se denomina <strong>paso de mensajes</strong> a este estilo de
programación que consiste en agrupar, dentro de una función que responde
a diferentes mensajes, las operaciones que actúan sobre un
dato.</p></li>
<li><p>El paso de mensajes combina <strong>dos técnicas de
programación</strong>:</p>
<ul>
<li><p>Las <strong>funciones de orden superior</strong> que devuelven
otras funciones.</p></li>
<li><p>El uso de una función que <strong><em>despacha</em></strong> a
otras funciones dependiendo del mensaje recibido.</p></li>
</ul></li>
</ul>
</section>

<section id="especificación-de-datos-abstractos-con-estado-interno"
class="title-slide slide level2" data-number="5.5">
<h2 data-number="5.5"><span class="header-section-number">5.5</span>
Especificación de datos abstractos con estado interno</h2>
<ul>
<li><p>Ya hemos dicho que las especificaciones algebraicas no nos sirven
para especificar un tipo abstracto que contenga estado interno y
mutabilidad, porque las operaciones ya no conservan la transparencia
referencial y sus propiedades ya no siempre se pueden describir con
ecuaciones.</p></li>
<li><p>Lo que sí se puede hacer es usar el lenguaje natural para
describir dichas propiedades.</p></li>
<li><p>El resultado es mucho menos elegante y formal, además de que
favorece la aparición de ambigüedades en la interpretación, pero es lo
mejor que podemos hacer, en general.</p></li>
</ul>
</section>
<section class="slide level5" data-number="5.5.0.0.1">

<ul>
<li><p>Por ejemplo, la especificación del tipo <strong>Depósito</strong>
podría expresarse así si no hubiera mutabilidad ni estado interno:</p>
<div class="line-block"><strong>espec</strong> <em>depósito</em><br />
       <strong>operaciones</strong><br />
             <code>depósito</code> : <span
class="math inline">\mathbb{R}</span> <span
class="math inline">\rightarrow</span> <em>depósito</em><br />
             <strong>parcial</strong> <code>retirar</code> :
<em>depósito</em> <span class="math inline">\times</span> <span
class="math inline">\mathbb{R}</span> <span
class="math inline">\rightarrow</span> <span
class="math inline">\mathbb{R}</span><br />
             <code>ingresar</code> : <em>depósito</em> <span
class="math inline">\times</span> <span
class="math inline">\mathbb{R}</span> <span
class="math inline">\rightarrow</span> <span
class="math inline">\mathbb{R}</span><br />
             <code>saldo</code> : <em>depósito</em> <span
class="math inline">\rightarrow</span> <span
class="math inline">\mathbb{R}</span><br />
       <strong>ecuaciones</strong><br />
             <span class="math inline">f &lt; c</span> <span
class="math inline">\Rightarrow</span>
<code>retirar</code>(<code>depósito</code>(<span
class="math inline">f</span>), <span class="math inline">c</span>) <span
class="math inline">\equiv</span> <span
class="math inline">error</span><br />
             <span class="math inline">f \geq c</span> <span
class="math inline">\Rightarrow</span>
<code>retirar</code>(<code>depósito</code>(<span
class="math inline">f</span>), <span class="math inline">c</span>) <span
class="math inline">\equiv</span> <code>depósito</code>(<span
class="math inline">f - c</span>)<br />
             <code>ingresar</code>(<code>depósito</code>(<span
class="math inline">f</span>), <span class="math inline">c</span>) <span
class="math inline">\equiv</span> <code>depósito</code>(<span
class="math inline">f + c</span>)<br />
             <code>saldo</code>(<code>depósito</code>(<span
class="math inline">f</span>)) <span class="math inline">\equiv</span>
<span class="math inline">f</span></div></li>
<li><p><code>depósito</code> es la operación generadora.</p></li>
<li><p><code>retirar</code> e <code>ingresar</code> son operaciones
modificadoras.</p></li>
<li><p><code>saldo</code> es una operación selectora.</p></li>
</ul>
</section>
<section class="slide level5" data-number="5.5.0.0.2">

<ul>
<li><p>Si el dato abstracto es mutable y recuerda su estado interno,
<strong>las operaciones modificadoras</strong> ya no producen un nuevo
dato <strong>Depósito</strong> a partir de otro, sino que
<strong>cambian el estado interno del dato existente</strong>.</p></li>
<li><p>En tal caso, esas operaciones se denominan
<strong>mutadoras</strong> y la especificación debe describir, entre
otras cosas, el <strong>efecto</strong> que producen las operaciones
mutadoras sobre el dato abstracto.</p></li>
</ul>
<div class="line-block"><strong>espec</strong> <em>depósito</em><br />
       <strong>operaciones</strong><br />
             <code>depósito</code> : <span
class="math inline">\mathbb{R}</span> <span
class="math inline">\rightarrow</span> <em>depósito</em><br />
             <strong>parcial</strong> <code>retirar</code> :
<em>depósito</em> <span class="math inline">\times</span> <span
class="math inline">\mathbb{R}</span> <span
class="math inline">\rightarrow</span> <span
class="math inline">\empty</span><br />
             <code>ingresar</code> : <em>depósito</em> <span
class="math inline">\times</span> <span
class="math inline">\mathbb{R}</span> <span
class="math inline">\rightarrow</span> <span
class="math inline">\empty</span><br />
             <code>saldo</code> : <em>depósito</em> <span
class="math inline">\rightarrow</span> <span
class="math inline">\mathbb{R}</span><br />
       <strong>var</strong><br />
             <span class="math inline">d</span> : <em>depósito</em>;
<span class="math inline">f</span>, <span class="math inline">c</span> :
<span class="math inline">\mathbb{R}</span><br />
       <strong>ecuaciones</strong><br />
             <code>depósito</code>(<span class="math inline">f</span>)
  { Crea un depósito con un fondo (estado interno) inicial de <span
class="math inline">f</span><br />
                                                y lo devuelve }<br />
             <code>saldo</code>(<span class="math inline">d</span>)
<span class="math inline">\equiv</span> «los fondos actuales de <span
class="math inline">d</span>»<br />
             <code>saldo</code>(<span class="math inline">d</span>)
<span class="math inline">\geq</span> <span class="math inline">c</span>
<span class="math inline">\Rightarrow</span> <code>retirar</code>(<span
class="math inline">d</span>, <span class="math inline">c</span>)   {
Reduce en <span class="math inline">c</span> unidades los fondos del
depósito <span class="math inline">d</span> }<br />
             <code>saldo</code>(<span class="math inline">d</span>)
<span class="math inline">&lt;</span> <span class="math inline">c</span>
<span class="math inline">\Rightarrow</span> <code>retirar</code>(<span
class="math inline">d</span>, <span class="math inline">c</span>) <span
class="math inline">\equiv</span> <span
class="math inline">error</span><br />
             <code>ingresar</code>(<span class="math inline">d</span>,
<span class="math inline">c</span>)   { Aumenta en <span
class="math inline">c</span> unidades los fondos del depósito <span
class="math inline">d</span> }</div>
</section>
<section class="slide level5" data-number="5.5.0.0.3">

<ul>
<li><p>Los <em>efectos</em> que produce una operación se indican entre
llaves { } al lado de la operación correspondiente.</p>
<p>Toda operación <em>impura</em> debe indicar sus efectos entre
llaves.</p></li>
<li><p>La signatura de las operaciones <code>retirar</code> e
<code>ingresar</code> indican mediante «<span
class="math inline">\rightarrow \empty</span>» que son operaciones que
no devuelven ningún valor, ya que su cometido es el de provocar un
efecto lateral (en este caso, modificar el estado interno del
<strong>Depósito</strong>).</p></li>
<li><p>En concreto, los efectos que producen dichas operaciones son los
de cambiar los fondos del depósito, restándole o sumándole una
cantidad.</p></li>
<li><p>Por tanto, una vez ejecutada cualquiera de esas operaciones, se
habrá cambiado el estado interno del dato abstracto.</p></li>
<li><p>Es por eso que llamamos <strong>mutadoras</strong> a ese tipo de
operaciones.</p></li>
</ul>
</section>
<section class="slide level5" data-number="5.5.0.0.4">

<ul>
<li><p>Otra opción es que las operaciones mutadoras devolvieran un valor
además de cambiar el estado interno del dato abstracto (por ejemplo, el
saldo que queda en el depósito tras ingresar o retirar
efectivo).</p></li>
<li><p>En tal caso, podría quedar algo así:</p></li>
</ul>
<div class="line-block"><strong>espec</strong> <em>depósito</em><br />
       <strong>operaciones</strong><br />
             <code>depósito</code> : <span
class="math inline">\mathbb{R}</span> <span
class="math inline">\rightarrow</span> <em>depósito</em><br />
             <strong>parcial</strong> <code>retirar</code> :
<em>depósito</em> <span class="math inline">\times</span> <span
class="math inline">\mathbb{R}</span> <span
class="math inline">\rightarrow</span> <span
class="math inline">\mathbb{R}</span><br />
             <code>ingresar</code> : <em>depósito</em> <span
class="math inline">\times</span> <span
class="math inline">\mathbb{R}</span> <span
class="math inline">\rightarrow</span> <span
class="math inline">\mathbb{R}</span><br />
             <code>saldo</code> : <em>depósito</em> <span
class="math inline">\rightarrow</span> <span
class="math inline">\mathbb{R}</span><br />
       <strong>var</strong><br />
             <span class="math inline">d</span> : <em>depósito</em>;
<span class="math inline">f</span>, <span class="math inline">c</span> :
<span class="math inline">\mathbb{R}</span><br />
       <strong>ecuaciones</strong><br />
             <code>depósito</code>(<span class="math inline">f</span>)
  { Crea un depósito con un fondo (estado interno) inicial de <span
class="math inline">f</span><br />
                                                y lo devuelve }<br />
             <code>saldo</code>(<span class="math inline">d</span>)
<span class="math inline">\equiv</span> «los fondos actuales de <span
class="math inline">d</span>»<br />
             <code>saldo</code>(<span class="math inline">d</span>)
<span class="math inline">\geq</span> <span class="math inline">c</span>
<span class="math inline">\Rightarrow</span> <code>retirar</code>(<span
class="math inline">d</span>, <span class="math inline">c</span>)   {
Reduce en <span class="math inline">c</span> unidades los fondos del
depósito <span class="math inline">d</span><br />
                                                                                     
y devuelve el saldo que queda }<br />
             <code>saldo</code>(<span class="math inline">d</span>)
<span class="math inline">&lt;</span> <span class="math inline">c</span>
<span class="math inline">\Rightarrow</span> <code>retirar</code>(<span
class="math inline">d</span>, <span class="math inline">c</span>) <span
class="math inline">\equiv</span> <span
class="math inline">error</span><br />
             <code>ingresar</code>(<span class="math inline">d</span>,
<span class="math inline">c</span>)   { Aumenta en <span
class="math inline">c</span> unidades los fondos del depósito <span
class="math inline">d</span><br />
                                                     y devuelve el saldo
que queda }</div>
</section>
</section>
<section>
<section id="abstracción-de-datos-y-modularidad"
class="title-slide slide level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span>
Abstracción de datos y modularidad</h1>

</section>
<section id="el-tipo-abstracto-como-módulo"
class="title-slide slide level2" data-number="6.1">
<h2 data-number="6.1"><span class="header-section-number">6.1</span> El
tipo abstracto como módulo</h2>
<ul>
<li><p>Claramente, un <strong>tipo abstracto</strong> representa una
<strong>abstracción</strong>:</p>
<ul>
<li><p>Se <strong>destacan</strong> los detalles (normalmente pocos) de
la <strong>especificación</strong>, es decir, el <em>comportamiento
observable</em> del tipo. Es de esperar que este aspecto sea bastante
estable y cambie poco durante la vida útil del programa.</p></li>
<li><p>Se <strong>ocultan</strong> los detalles (normalmente numerosos)
de la <strong>implementación</strong>. Este aspecto es, además, propenso
a cambios.</p></li>
</ul></li>
<li><p>Y estas propiedades anteriores hacen que el tipo abstracto sea el
concepto ideal alrededor del cual basar la descomposición en módulos de
un programa grande.</p></li>
</ul>
</section>
<section class="slide level5" data-number="6.1.0.0.1">

<ul>
<li><p>Recordemos que para que haya una buena modularidad:</p>
<ul>
<li><p>Las <strong>conexiones</strong> del módulo con el resto del
programa han de ser pocas y simples. De este modo se espera lograr una
relativa independencia en el desarrollo de cada módulo con respecto a
los otros.</p></li>
<li><p>La <strong>descomposición</strong> en módulos ha de ser tal que
la mayor parte de los cambios y mejoras al programa impliquen modificar
sólo un módulo o un número muy pequeño de ellos.</p></li>
<li><p>El <strong>tamaño</strong> de un módulo ha de ser el adecuado: si
es demasiado grande, será difícil realizar cambios en él; si es
demasiado pequeño, los costes de integración con otros módulos
aumenta.</p></li>
</ul></li>
</ul>
</section>
<section class="slide level5" data-number="6.1.0.0.2">

<ul>
<li><p>La parte del código fuente de un programa dedicada a la
definición de un tipo abstracto de datos es un <strong>candidato a
módulo</strong> que cumple las siguientes propiedades:</p>
<ul>
<li><p>La <strong>especificación</strong> del tipo abstracto es un
ejemplo de pocas y simples conexiones con el resto del programa: los
usuarios simplemente invocan sus operaciones permitidas. Otras
conexiones más peligrosas, como compartir variables entre módulos o
conocer la representración interna, son imposibles.</p></li>
<li><p>La <strong>implementación</strong> puede cambiarse libremente sin
afectar al funcionamiento de los módulos usuarios. Es de esperar, por
tanto, que muchos cambios al programa queden localizados en el interior
de un sólo módulo.</p></li>
<li><p>El <strong>tamaño</strong> de una sola función que implementa una
abstracción funcional es demasiado pequeño para ser útil como unidad
modular. En cambio, la definición de un tipo abstracto consta, en
general, de una colección de funciones más una representación, lo que
proporciona un tamaño más adecuado.</p></li>
</ul></li>
</ul>
</section>
<section class="slide level5" data-number="6.1.0.0.3">

<ul>
<li><p>Un tipo abstracto de datos conecta perfectamente con los cuatro
conceptos más importantes relacionados con la modularidad:</p>
<ul>
<li><p>Es una <strong>abstracción</strong>: se usa sin necesidad de
saber cómo se implementa.</p></li>
<li><p><strong>Oculta información</strong>: los detalles y las
decisiones de diseño quedan en la implementación del tipo abstracto, y
son innecesarios para poder usarlo.</p></li>
<li><p>Es <strong>funcionalmente independiente</strong>: es un módulo
destinado a una sola tarea, con alta cohesión y bajo
acoplamiento.</p></li>
<li><p>Es <strong>reutilizable</strong>: su comportamiento puede
resultar tan general que puede usarse en diferentes programas con
ninguna o muy poca modificación.</p></li>
</ul></li>
</ul>
</section>
</section>
<section id="bibliografía"
class="title-slide slide level1 unnumbered unlisted">
<h1 class="unnumbered unlisted">Bibliografía</h1>
<div id="refs" class="references csl-bib-body hanging-indent"
data-entry-spacing="0" role="list">
<div id="ref-abelson_structure_1996" class="csl-entry" role="listitem">
Abelson, Harold, Gerald Jay Sussman, and Julie Sussman. 1996.
<em>Structure and Interpretation of Computer Programs</em>. 2nd ed.
Cambridge, Mass. : New York: MIT Press ; McGraw-Hill.
</div>
<div id="ref-denero_composing_nodate" class="csl-entry" role="listitem">
DeNero, John. n.d. <span>“Composing <span>Programs</span>.”</span> <a
href="http://www.composingprograms.com">http://www.composingprograms.com</a>.
</div>
<div id="ref-pena_mari_diseno_2003" class="csl-entry" role="listitem">
Peña Marí, Ricardo. 2003. <em>Diseño de Programas: Formalismo y
Abstracción</em>. Madrid: Prentice Hall.
</div>
<div id="ref-python_software_foundation_sitio_nodate" class="csl-entry"
role="listitem">
Python Software Foundation. n.d. <span>“Sitio Web de Documentación de
<span>Python</span>.”</span> <a
href="https://docs.python.org/3">https://docs.python.org/3</a>.
</div>
</div>
</section>
    </div>
  </div>

  <script src="./reveal.js/dist/reveal.js"></script>

  <!-- reveal.js plugins -->
  <script src="./reveal.js/plugin/notes/notes.js"></script>
  <script src="./reveal.js/plugin/search/search.js"></script>
  <script src="./reveal.js/plugin/zoom/zoom.js"></script>
  <script src="./reveal.js/plugin/reveal.js-menu/menu.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'bottom-right',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: true,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: false,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: true,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: true,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1280,

        height: 1080,
        // The display mode that will be used to show slides
        display: 'block',

        menu: {
          hideMissingTitles: true,
        },

        dependencies: [
          { src: './reveal.js/plugin/reveal.js-quiz/quiz/js/quiz.js', async: true, callback: function() { prepareQuizzes({preventUnanswered: true, checkAnswerText: 'Comprueba la respuesta', nextQuestionText: 'Siguiente &raquo;', backButtonText: '&laquo; Anterior', tryAgainText: 'Prueba de nuevo', preventUnansweredText: 'Selecciona una respuesta', questionCountText: 'Pregunta %current de %total', skipStartButton: true}); } }
        ],

        // reveal.js plugins
        plugins: [
          RevealMenu,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script type="text/javascript">
       var title = document.getElementsByClassName('title')[0];
       title = title != null ? title.innerHTML : '';
       var author = document.getElementsByClassName('author')[0];
       author = author != null ? author.innerHTML : '';
       var date = document.getElementsByClassName('date')[0];
       date = date != null ? date.innerHTML : '';
       document.getElementById('header-left').innerHTML = '<a href="#/title-slide">' + title + '</a>';
       document.getElementById('footer-left').innerHTML = '<a href="https://pro.iesdonana.org">&copy; ' + author + ' (' + date + ')</a>';

       function updateHeader(nd) {
           var hr = document.getElementById('header-right');
           while (hr.children.length > 0) {
               hr.removeChild(hr.lastChild);
           }
           buscar(nd, 3, hr);
           buscar(nd, 2, hr);
           buscar(nd, 1, hr);
           hr.style.fontSize = Math.round(50 * Reveal.getScale()) + '%';
           hr.style.fontSize = Math.max(Number.parseInt(getComputedStyle(hr).fontSize), 12) + 'px';
           var hl = document.getElementById('header-left');
           hl.style.fontSize = hr.style.fontSize;
       }

       function buscar(nd, level, hr) {
           if (!nd.classList.contains('level' + (level - 1))) {
               for (var n = nd; n != null; n = n.previousSibling) {
                   if (n.nodeType == Node.TEXT_NODE) {
                       continue;
                   }
                   var cl = n.classList;
                   if (cl.contains('level' + level)) {
                       var h = n.querySelector('h' + level);
                   } else if (cl.contains('level' + (level - 1))) {
                       break;
                   } else {
                       continue;
                   }
                   if (h == null || Reveal.getCurrentSlide().id == 'title-slide') {
                       hr.innerHTML = '';
                   } else {
                       var el = document.createElement('a');
                       var href = '#/' + n.id;
                       el.href = href;
                       el.innerHTML = h.innerHTML;
                       var a = el.querySelector('a');
                       if (a !== null) {
                           a.href = href;
                       }
                       if (hr.innerHTML != '') {
                           hr.innerHTML = ' &mdash; ' + hr.innerHTML;
                       }
                       hr.insertBefore(el, hr.firstChild);
                   }
                   break;
               }
           }
       }

       // On Reveal.js ready event, copy header/footer <div>
       // into each `.slide-background` <div>
       Reveal.on('ready', event => {
           var header = document.getElementById('header');
           document.querySelector('.reveal').appendChild(header);
           updateHeader(Reveal.getCurrentSlide());
       });

       Reveal.on('slidechanged', event => {
           // event.previousSlide, event.currentSlide, event.indexh, event.indexv
           updateHeader(event.currentSlide);
       });
    </script>
    </body>
</html>
